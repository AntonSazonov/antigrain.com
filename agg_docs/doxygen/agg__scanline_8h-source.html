<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>agg_scanline.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>agg_scanline.h</h1><a href="agg__scanline_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------------</font>
00002 <font class="comment">// Anti-Grain Geometry - Version 2.0 </font>
00003 <font class="comment">// Copyright (C) 2002 Maxim Shemanarev (McSeem)</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Permission to copy, use, modify, sell and distribute this software </font>
00006 <font class="comment">// is granted provided this copyright notice appears in all copies. </font>
00007 <font class="comment">// This software is provided "as is" without express or implied</font>
00008 <font class="comment">// warranty, and with no claim as to its suitability for any purpose.</font>
00009 <font class="comment">//</font>
00010 <font class="comment">//----------------------------------------------------------------------------</font>
00011 <font class="comment">// Contact: mcseem@antigrain.com</font>
00012 <font class="comment">//          mcseemagg@yahoo.com</font>
00013 <font class="comment">//          http://www.antigrain.com</font>
00014 <font class="comment">//----------------------------------------------------------------------------</font>
00015 <font class="comment">//</font>
00016 <font class="comment">// scanline class</font>
00017 <font class="comment">//</font>
00018 <font class="comment">//----------------------------------------------------------------------------</font>
00019 <font class="preprocessor">#ifndef AGG_SCANLINE_INCLUDED</font>
00020 <font class="preprocessor"></font><font class="preprocessor">#define AGG_SCANLINE_INCLUDED</font>
00021 <font class="preprocessor"></font>
00022 <font class="preprocessor">#include "<a class="code" href="agg__basics_8h.html">agg_basics.h</a>"</font>
00023 
00024 <font class="keyword">namespace </font>agg
00025 {
00026     <font class="comment">//========================================================================</font>
00027     <font class="comment">//</font>
00028     <font class="comment">// This class is used to transfer data from class outline (or a similar one)</font>
00029     <font class="comment">// to rendering buffer. It's organized very simple. The class stores information</font>
00030     <font class="comment">// of horizontal spans to render it into a pixel-map buffer. Each span has</font>
00031     <font class="comment">// initial X, length, and an array of bytes that determine alpha-value for</font>
00032     <font class="comment">// each pixel. So the restriction of using this class is 256 levels of </font>
00033     <font class="comment">// Anti-Aliasing, which is quite enough for any practical purpose.</font>
00034     <font class="comment">// Before using this class you should know the minimal and maximal pixel </font>
00035     <font class="comment">// coordinates of your scanline. The protocol of usage is:</font>
00036     <font class="comment">// 1. reset(min_x, max_x)</font>
00037     <font class="comment">// 2. add_cell() / add_span() - accumulate scanline. You pass Y-coordinate </font>
00038     <font class="comment">//    into these functions in order to make scanline know the last Y. Before </font>
00039     <font class="comment">//    calling add_cell() / add_span() you should check if the last Y has changed</font>
00040     <font class="comment">//    with method is_ready(y) - it also checks if the scanline is not empty. </font>
00041     <font class="comment">//    When forming one scanline the next X coordinate must be always greater</font>
00042     <font class="comment">//    than the last stored one, i.e. it works only with ordered coordinates.</font>
00043     <font class="comment">// 3. If the current scanline is ready you should render it and then call </font>
00044     <font class="comment">//    reset_spans() in order to clear the current scanline.</font>
00045     <font class="comment">//    </font>
00046     <font class="comment">// Rendering:</font>
00047     <font class="comment">// </font>
00048     <font class="comment">// sl - pointer to a passed scanline.</font>
00049     <font class="comment">// . . .</font>
00050     <font class="comment">// if(sl-&gt;reset_iterator(clip_box)) // Reset iterator. Returns false if current</font>
00051     <font class="comment">//                                  // Y is out of clipbox.</font>
00052     <font class="comment">// {</font>
00053     <font class="comment">//     int y = sl-&gt;get_y();                       // Get current Y</font>
00054     <font class="comment">//     unsigned num_spans = sl-&gt;get_num_spans();  // Get the number of spans</font>
00055     <font class="comment">//</font>
00056     <font class="comment">//     while(num_spans--) </font>
00057     <font class="comment">//     {</font>
00058     <font class="comment">//         if(sl-&gt;next_span())                    // Advance span pointer</font>
00059     <font class="comment">//         {</font>
00060     <font class="comment">//             const unsigned char* covers = sl-&gt;get_covers(); // Array of alpha-values</font>
00061     <font class="comment">//</font>
00062     <font class="comment">//             unsigned count = sl-&gt;get_count();               // Count (length of span)</font>
00063     <font class="comment">//</font>
00064     <font class="comment">//             while(count--)</font>
00065     <font class="comment">//             {</font>
00066     <font class="comment">//                 *dst++ = *covers++; // Hypotetical rendering. </font>
00067     <font class="comment">//                                     // dst - pointer to destination pixel-map</font>
00068     <font class="comment">//             }</font>
00069     <font class="comment">//         }</font>
00070     <font class="comment">//     }</font>
00071     <font class="comment">// }</font>
00072 
<a name="l00073"></a><a class="code" href="classagg_1_1scanline.html">00073</a>     <font class="keyword">class </font>scanline
00074     {
00075     <font class="keyword">public</font>:
00076         <a class="code" href="classagg_1_1scanline.html#a0">~scanline</a>();
00077         <a class="code" href="classagg_1_1scanline.html#a1">scanline</a>();
00078 
00079         <font class="keywordtype">void</font>     <a class="code" href="classagg_1_1scanline.html#a2">reset</a>(<font class="keywordtype">int</font> min_x, <font class="keywordtype">int</font> max_x);
00080 
00081         <font class="keywordtype">void</font>     <a class="code" href="classagg_1_1scanline.html#a3">reset_spans</a>();
00082         <font class="keywordtype">void</font>     <a class="code" href="classagg_1_1scanline.html#a4">add_cell</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">unsigned</font> cover);
00083         <font class="keywordtype">void</font>     <a class="code" href="classagg_1_1scanline.html#a5">add_span</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">unsigned</font> num, <font class="keywordtype">unsigned</font> cover);
00084         <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#a6">is_ready</a>(<font class="keywordtype">int</font> y);
00085 
<a name="l00086"></a><a class="code" href="classagg_1_1scanline.html#a7">00086</a>         <font class="keywordtype">unsigned</font> <a class="code" href="classagg_1_1scanline.html#a7">get_num_spans</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="classagg_1_1scanline.html#o7">m_num_spans</a>; }
00087 
00088         <font class="keywordtype">bool</font>           <a class="code" href="classagg_1_1scanline.html#a8">reset_iterator</a>(<font class="keyword">const</font> rect&amp; cb);
<a name="l00089"></a><a class="code" href="classagg_1_1scanline.html#a9">00089</a>         <font class="keyword">const</font> <font class="keywordtype">unsigned</font> <a class="code" href="classagg_1_1scanline.html#a9">get_count</a>()  <font class="keyword">const</font> { <font class="keywordflow">return</font> unsigned(<a class="code" href="classagg_1_1scanline.html#o14">m_clipped_count</a>); }
<a name="l00090"></a><a class="code" href="classagg_1_1scanline.html#a10">00090</a>         <font class="keyword">const</font> <a class="code" href="namespaceagg.html#a5">int8u</a>*   <a class="code" href="classagg_1_1scanline.html#a10">get_covers</a>()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> <a class="code" href="classagg_1_1scanline.html#o15">m_clipped_covers</a>; }
<a name="l00091"></a><a class="code" href="classagg_1_1scanline.html#a11">00091</a>         <font class="keyword">const</font> <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#a11">get_x</a>()      <font class="keyword">const</font> { <font class="keywordflow">return</font> <a class="code" href="classagg_1_1scanline.html#o13">m_clipped_x</a>; }
<a name="l00092"></a><a class="code" href="classagg_1_1scanline.html#a12">00092</a>         <font class="keyword">const</font> <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#a12">get_y</a>()      <font class="keyword">const</font> { <font class="keywordflow">return</font> <a class="code" href="classagg_1_1scanline.html#o3">m_last_y</a>; }
<a name="l00093"></a><a class="code" href="classagg_1_1scanline.html#a13">00093</a>         <font class="keyword">const</font> <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#a13">get_min_x</a>()  <font class="keyword">const</font> { <font class="keywordflow">return</font> <a class="code" href="classagg_1_1scanline.html#o0">m_min_x</a>; }
00094         <font class="keywordtype">bool</font>           <a class="code" href="classagg_1_1scanline.html#a14">next_span</a>();
00095 
00096     <font class="keyword">private</font>:
00097         <a class="code" href="classagg_1_1scanline.html#a1">scanline</a>(<font class="keyword">const</font> <a class="code" href="classagg_1_1scanline.html#a1">scanline</a>&amp;);
00098         <font class="keyword">const</font> <a class="code" href="classagg_1_1scanline.html#a1">scanline</a>&amp; <a class="code" href="classagg_1_1scanline.html#c1">operator = </a>(<font class="keyword">const</font> <a class="code" href="classagg_1_1scanline.html#a1">scanline</a>&amp;);
00099 
00100     <font class="keyword">private</font>:
<a name="l00101"></a><a class="code" href="classagg_1_1scanline.html#o0">00101</a>         <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#o0">m_min_x</a>;
<a name="l00102"></a><a class="code" href="classagg_1_1scanline.html#o1">00102</a>         <font class="keywordtype">unsigned</font> <a class="code" href="classagg_1_1scanline.html#o1">m_max_len</a>;
<a name="l00103"></a><a class="code" href="classagg_1_1scanline.html#o2">00103</a>         <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#o2">m_last_x</a>;
<a name="l00104"></a><a class="code" href="classagg_1_1scanline.html#o3">00104</a>         <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#o3">m_last_y</a>;
<a name="l00105"></a><a class="code" href="classagg_1_1scanline.html#o4">00105</a>         <a class="code" href="namespaceagg.html#a5">int8u</a>*   <a class="code" href="classagg_1_1scanline.html#o4">m_covers</a>;
<a name="l00106"></a><a class="code" href="classagg_1_1scanline.html#o5">00106</a>         <a class="code" href="namespaceagg.html#a5">int8u</a>**  <a class="code" href="classagg_1_1scanline.html#o5">m_start_ptrs</a>;
<a name="l00107"></a><a class="code" href="classagg_1_1scanline.html#o6">00107</a>         <a class="code" href="namespaceagg.html#a7">int16u</a>*  <a class="code" href="classagg_1_1scanline.html#o6">m_counts</a>;
<a name="l00108"></a><a class="code" href="classagg_1_1scanline.html#o7">00108</a>         <font class="keywordtype">unsigned</font> <a class="code" href="classagg_1_1scanline.html#o7">m_num_spans</a>;
<a name="l00109"></a><a class="code" href="classagg_1_1scanline.html#o8">00109</a>         <a class="code" href="namespaceagg.html#a5">int8u</a>*   <a class="code" href="classagg_1_1scanline.html#o8">m_cur_covers</a>;
<a name="l00110"></a><a class="code" href="classagg_1_1scanline.html#o9">00110</a>         <a class="code" href="namespaceagg.html#a5">int8u</a>**  <a class="code" href="classagg_1_1scanline.html#o9">m_cur_start_ptr</a>;
<a name="l00111"></a><a class="code" href="classagg_1_1scanline.html#o10">00111</a>         <a class="code" href="namespaceagg.html#a7">int16u</a>*  <a class="code" href="classagg_1_1scanline.html#o10">m_cur_count</a>;
00112 
<a name="l00113"></a><a class="code" href="classagg_1_1scanline.html#o11">00113</a>         <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#o11">m_clip_x1</a>;
<a name="l00114"></a><a class="code" href="classagg_1_1scanline.html#o12">00114</a>         <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#o12">m_clip_x2</a>;
00115 
<a name="l00116"></a><a class="code" href="classagg_1_1scanline.html#o13">00116</a>         <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#o13">m_clipped_x</a>;
<a name="l00117"></a><a class="code" href="classagg_1_1scanline.html#o14">00117</a>         <font class="keywordtype">int</font>      <a class="code" href="classagg_1_1scanline.html#o14">m_clipped_count</a>;
<a name="l00118"></a><a class="code" href="classagg_1_1scanline.html#o15">00118</a>         <a class="code" href="namespaceagg.html#a5">int8u</a>*   <a class="code" href="classagg_1_1scanline.html#o15">m_clipped_covers</a>;
00119     };
00120 
00121 
00122     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00123"></a><a class="code" href="classagg_1_1scanline.html#a8">00123</a>     <font class="keyword">inline</font> <font class="keywordtype">bool</font> scanline::reset_iterator(<font class="keyword">const</font> rect&amp; cb)
00124     {
00125         <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1scanline.html#o3">m_last_y</a> &lt; cb.y1 || <a class="code" href="classagg_1_1scanline.html#o3">m_last_y</a> &gt; cb.y2) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00126         <a class="code" href="classagg_1_1scanline.html#o11">m_clip_x1</a> = cb.x1;
00127         <a class="code" href="classagg_1_1scanline.html#o12">m_clip_x2</a> = cb.x2;
00128         <a class="code" href="classagg_1_1scanline.html#o10">m_cur_count</a>     = <a class="code" href="classagg_1_1scanline.html#o6">m_counts</a>;
00129         <a class="code" href="classagg_1_1scanline.html#o9">m_cur_start_ptr</a> = <a class="code" href="classagg_1_1scanline.html#o5">m_start_ptrs</a>;
00130         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00131     }
00132 
00133 
00134     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00135"></a><a class="code" href="classagg_1_1scanline.html#a14">00135</a>     <font class="keyword">inline</font> <font class="keywordtype">bool</font> scanline::next_span()
00136     {
00137         <a class="code" href="classagg_1_1scanline.html#o14">m_clipped_count</a>  = *(++<a class="code" href="classagg_1_1scanline.html#o10">m_cur_count</a>);
00138         <a class="code" href="classagg_1_1scanline.html#o15">m_clipped_covers</a> = *(++<a class="code" href="classagg_1_1scanline.html#o9">m_cur_start_ptr</a>);
00139         <a class="code" href="classagg_1_1scanline.html#o13">m_clipped_x</a> = int(*<a class="code" href="classagg_1_1scanline.html#o9">m_cur_start_ptr</a> - <a class="code" href="classagg_1_1scanline.html#o4">m_covers</a>) + <a class="code" href="classagg_1_1scanline.html#o0">m_min_x</a>;
00140 
00141         <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1scanline.html#o13">m_clipped_x</a> &lt; <a class="code" href="classagg_1_1scanline.html#o11">m_clip_x1</a>)
00142         {
00143             <a class="code" href="classagg_1_1scanline.html#o14">m_clipped_count</a> -= <a class="code" href="classagg_1_1scanline.html#o11">m_clip_x1</a> - <a class="code" href="classagg_1_1scanline.html#o13">m_clipped_x</a>;
00144             <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1scanline.html#o14">m_clipped_count</a> &lt;= 0) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00145             <a class="code" href="classagg_1_1scanline.html#o15">m_clipped_covers</a> += <a class="code" href="classagg_1_1scanline.html#o11">m_clip_x1</a> - <a class="code" href="classagg_1_1scanline.html#o13">m_clipped_x</a>;
00146             <a class="code" href="classagg_1_1scanline.html#o13">m_clipped_x</a> = <a class="code" href="classagg_1_1scanline.html#o11">m_clip_x1</a>;
00147         }
00148         <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1scanline.html#o13">m_clipped_x</a> + <a class="code" href="classagg_1_1scanline.html#o14">m_clipped_count</a> &gt; <a class="code" href="classagg_1_1scanline.html#o12">m_clip_x2</a>)
00149         {
00150             <a class="code" href="classagg_1_1scanline.html#o14">m_clipped_count</a> -= <a class="code" href="classagg_1_1scanline.html#o13">m_clipped_x</a> + <a class="code" href="classagg_1_1scanline.html#o14">m_clipped_count</a> - <a class="code" href="classagg_1_1scanline.html#o12">m_clip_x2</a> - 1;
00151             <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1scanline.html#o14">m_clipped_count</a> &lt;= 0) <font class="keywordflow">return</font> <font class="keyword">false</font>;
00152         }
00153         <font class="keywordflow">return</font> <font class="keyword">true</font>;
00154     }
00155 
00156 
00157     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00158"></a><a class="code" href="classagg_1_1scanline.html#a3">00158</a>     <font class="keyword">inline</font> <font class="keywordtype">void</font> scanline::reset_spans()
00159     {
00160         <a class="code" href="classagg_1_1scanline.html#o2">m_last_x</a>        = 0x7FFF;
00161         <a class="code" href="classagg_1_1scanline.html#o3">m_last_y</a>        = 0x7FFF;
00162         <a class="code" href="classagg_1_1scanline.html#o10">m_cur_count</a>     = <a class="code" href="classagg_1_1scanline.html#o6">m_counts</a>;
00163         <a class="code" href="classagg_1_1scanline.html#o9">m_cur_start_ptr</a> = <a class="code" href="classagg_1_1scanline.html#o5">m_start_ptrs</a>;
00164         <a class="code" href="classagg_1_1scanline.html#o7">m_num_spans</a>     = 0;
00165     }
00166 
00167 
00168     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00169"></a><a class="code" href="classagg_1_1scanline.html#a4">00169</a>     <font class="keyword">inline</font> <font class="keywordtype">void</font> scanline::add_cell(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">unsigned</font> cover)
00170     {
00171         x -= <a class="code" href="classagg_1_1scanline.html#o0">m_min_x</a>;
00172         <a class="code" href="classagg_1_1scanline.html#o4">m_covers</a>[x] = (<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>)cover;
00173         <font class="keywordflow">if</font>(x == <a class="code" href="classagg_1_1scanline.html#o2">m_last_x</a>+1)
00174         {
00175             (*m_cur_count)++;
00176         }
00177         <font class="keywordflow">else</font>
00178         {
00179             *++<a class="code" href="classagg_1_1scanline.html#o10">m_cur_count</a> = 1;
00180             *++<a class="code" href="classagg_1_1scanline.html#o9">m_cur_start_ptr</a> = <a class="code" href="classagg_1_1scanline.html#o4">m_covers</a> + x;
00181             <a class="code" href="classagg_1_1scanline.html#o7">m_num_spans</a>++;
00182         }
00183         <a class="code" href="classagg_1_1scanline.html#o2">m_last_x</a> = x;
00184         <a class="code" href="classagg_1_1scanline.html#o3">m_last_y</a> = y;
00185     }
00186 
00187 
00188     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00189"></a><a class="code" href="classagg_1_1scanline.html#a6">00189</a>     <font class="keyword">inline</font> <font class="keywordtype">int</font> scanline::is_ready(<font class="keywordtype">int</font> y)
00190     {
00191         <font class="keywordflow">return</font> <a class="code" href="classagg_1_1scanline.html#o7">m_num_spans</a> &amp;&amp; (y ^ <a class="code" href="classagg_1_1scanline.html#o3">m_last_y</a>);
00192     }
00193 
00194 
00195 }
00196 
00197 <font class="preprocessor">#endif</font>
00198 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated on Tue Apr 23 09:06:34 2002 for AGG v2.0 beta by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
