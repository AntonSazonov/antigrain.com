<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>agg_bspline.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>agg_bspline.cpp</h1><a href="agg__bspline_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------------</font>
00002 <font class="comment">// Anti-Grain Geometry - Version 2.0 </font>
00003 <font class="comment">// Copyright (C) 2002 Maxim Shemanarev (McSeem)</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Permission to copy, use, modify, sell and distribute this software </font>
00006 <font class="comment">// is granted provided this copyright notice appears in all copies. </font>
00007 <font class="comment">// This software is provided "as is" without express or implied</font>
00008 <font class="comment">// warranty, and with no claim as to its suitability for any purpose.</font>
00009 <font class="comment">//</font>
00010 <font class="comment">//----------------------------------------------------------------------------</font>
00011 <font class="comment">// Contact: mcseem@antigrain.com</font>
00012 <font class="comment">//          mcseemagg@yahoo.com</font>
00013 <font class="comment">//          http://www.antigrain.com</font>
00014 <font class="comment">//----------------------------------------------------------------------------</font>
00015 <font class="comment">//</font>
00016 <font class="comment">// class bspline</font>
00017 <font class="comment">//</font>
00018 <font class="comment">//----------------------------------------------------------------------------</font>
00019 
00020 
00021 <font class="preprocessor">#include "<a class="code" href="agg__bspline_8h.html">agg_bspline.h</a>"</font>
00022 
00023 <font class="keyword">namespace </font>agg
00024 {
00025 
00026     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00027"></a><a class="code" href="classagg_1_1bspline.html#a0">00027</a>     bspline::~bspline()
00028     {
00029         <font class="keyword">delete</font> [] <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>;
00030     }
00031 
00032 
00033     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00034"></a><a class="code" href="classagg_1_1bspline.html#a1">00034</a>     bspline::bspline() :
00035         m_num(0),
00036         m_x(0),
00037         m_y(0),
00038         m_am(0)
00039     {
00040     }
00041 
00042 
00043     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00044"></a><a class="code" href="classagg_1_1bspline.html#a2">00044</a>     <font class="keywordtype">void</font> bspline::init(<font class="keywordtype">int</font> num, <font class="keywordtype">double</font>* x, <font class="keywordtype">double</font>* y)
00045     {
00046         <font class="keywordflow">if</font>(num &gt; 2 &amp;&amp; x &amp;&amp; y)
00047         {
00048             <font class="keywordtype">int</font> i, k, n1;
00049             <font class="keywordtype">double</font>* temp; 
00050             <font class="keywordtype">double</font>* r; 
00051             <font class="keywordtype">double</font>* s;
00052             <font class="keywordtype">double</font>* al; 
00053             <font class="keywordtype">double</font> h, p, d, f, e;
00054 
00055             <a class="code" href="classagg_1_1bspline.html#o1">m_x</a> = x;
00056             <a class="code" href="classagg_1_1bspline.html#o2">m_y</a> = y;
00057             <font class="keywordflow">if</font>(num != <a class="code" href="classagg_1_1bspline.html#o0">m_num</a>)
00058             {
00059                 <font class="keyword">delete</font> [] <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>;
00060                 <a class="code" href="classagg_1_1bspline.html#o3">m_am</a> = <font class="keyword">new</font> <font class="keywordtype">double</font>[<a class="code" href="classagg_1_1bspline.html#o0">m_num</a> = num];
00061             }
00062     
00063             <font class="keywordflow">for</font>(k = 0; k &lt; <a class="code" href="classagg_1_1bspline.html#o0">m_num</a>; k++) 
00064             {
00065                 <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[k] = 0.0;
00066             }
00067 
00068             n1 = 3 * <a class="code" href="classagg_1_1bspline.html#o0">m_num</a>;
00069 
00070             al = <font class="keyword">new</font> <font class="keywordtype">double</font>[n1];
00071             temp = al;
00072 
00073             <font class="keywordflow">for</font>(k = 0; k &lt; n1; k++) 
00074             {
00075                 temp[k] = 0.0;
00076             }
00077 
00078             temp += <a class="code" href="classagg_1_1bspline.html#o0">m_num</a>; r = temp;
00079             temp += <a class="code" href="classagg_1_1bspline.html#o0">m_num</a>; s = temp;
00080 
00081             n1 = <a class="code" href="classagg_1_1bspline.html#o0">m_num</a> - 1;
00082             d = <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[1] - <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[0];
00083             e = (<a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[1] - <a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[0]) / d;
00084 
00085             <font class="keywordflow">for</font>(k = 1; k &lt; n1; k++) 
00086             {
00087                 h     = d;
00088                 d     = <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[k + 1] - <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[k];
00089                 f     = e;
00090                 e     = (<a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[k + 1] - <a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[k]) / d;
00091                 al[k] = d / (d + h);
00092                 r[k]  = 1.0 - al[k];
00093                 s[k]  = 6.0 * (e - f) / (h + d);
00094             }
00095 
00096             <font class="keywordflow">for</font>(k = 1; k &lt; n1; k++) 
00097             {
00098                 p = 1.0 / (r[k] * al[k - 1] + 2.0);
00099                 al[k] *= -p;
00100                 s[k] = (s[k] - r[k] * s[k - 1]) * p; 
00101             }
00102 
00103             <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[n1]     = 0.0;
00104             al[n1 - 1]   = s[n1 - 1];
00105             <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[n1 - 1] = al[n1 - 1];
00106 
00107             <font class="keywordflow">for</font>(k = n1 - 2, i = 0; i &lt; <a class="code" href="classagg_1_1bspline.html#o0">m_num</a> - 2; i++) 
00108             {
00109                 al[k]   = al[k] * al[k + 1] + s[k];
00110                 <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[k] = al[k];
00111                 k--; 
00112             }
00113             <font class="keyword">delete</font> al;
00114         }
00115     }
00116 
00117 
00118 
00119 
00120     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00121"></a><a class="code" href="classagg_1_1bspline.html#f0">00121</a>     <font class="keywordtype">void</font> bspline::bsearch(<font class="keywordtype">int</font> n, <font class="keywordtype">double</font> *x, <font class="keywordtype">double</font> x0, <font class="keywordtype">int</font> *i, <font class="keywordtype">int</font> *j) 
00122     {
00123         <font class="keywordtype">int</font> k;
00124 
00125         *i = 0;  
00126         *j = n-1;
00127 
00128         <font class="keywordflow">for</font>(;;) 
00129         {
00130             <font class="keywordflow">if</font>((*j - *i) == 1) <font class="keywordflow">return</font>;
00131 
00132             <font class="keywordflow">if</font>(x0 &lt; x[k = (*i + *j) &gt;&gt; 1]) 
00133             {
00134                 *j = k; 
00135             }
00136             <font class="keywordflow">else</font>  
00137             {
00138                 *i = k;
00139             }
00140         }
00141     }
00142 
00143 
00144 
00145     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00146"></a><a class="code" href="classagg_1_1bspline.html#a3">00146</a>     <font class="keywordtype">double</font> bspline::get(<font class="keywordtype">double</font> x)<font class="keyword"> const</font>
00147 <font class="keyword">    </font>{
00148         <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1bspline.html#o0">m_num</a> &gt; 2 &amp;&amp; <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>)
00149         {
00150             <font class="keywordtype">int</font> i = -1, j, n;
00151             <font class="keywordtype">double</font> p, d, h;
00152             <font class="keywordtype">double</font> vol=0;
00153             <font class="keywordtype">double</font> rr;
00154 
00155             n  = <a class="code" href="classagg_1_1bspline.html#o0">m_num</a>;
00156 
00157             <font class="keywordflow">if</font>( x &lt; *<a class="code" href="classagg_1_1bspline.html#o1">m_x</a> ) 
00158             {
00159                 d   = <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[1] - (*m_x);
00160                 vol = -d * <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[1] / 6 + (<a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[1] - (*m_y)) / d;
00161                 vol = vol * (x - (*m_x)) + (*m_y);
00162                 <font class="keywordflow">return</font> vol;
00163             }
00164 
00165             <font class="keywordflow">if</font>( x &gt;= <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[n-1] ) 
00166             {
00167                 d   = <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[n - 1] - <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[n - 2];
00168                 vol = d * <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[n - 2] / 6 + (<a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[n - 1] - <a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[n - 2]) / d;
00169                 vol = vol * (x - <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[n - 1]) + (<a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[n - 1]);
00170                 <font class="keywordflow">return</font> vol;
00171             }
00172 
00173             <a class="code" href="classagg_1_1bspline.html#f0">bsearch</a>(n, <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>, x, &amp;i, &amp;j);
00174 
00175             d = <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[i] - <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[j];
00176             h = x - <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[j];
00177             rr= <a class="code" href="classagg_1_1bspline.html#o1">m_x</a>[i] - x;
00178             p = d * d / 6.0;
00179             vol= (<a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[j] * rr * rr * rr + <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[i] * h * h * h) / 6.0 / d;
00180             vol += ((<a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[j] - <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[j] * p) * rr + (<a class="code" href="classagg_1_1bspline.html#o2">m_y</a>[i] - <a class="code" href="classagg_1_1bspline.html#o3">m_am</a>[i] * p) * h) / d;
00181             <font class="keywordflow">return</font> vol;
00182         }
00183 
00184         <font class="keywordflow">return</font> 0.0;
00185     }
00186 
00187 
00188 }
00189 
</pre></div><hr><address><small>Generated on Tue Apr 23 09:06:33 2002 for AGG v2.0 beta by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
