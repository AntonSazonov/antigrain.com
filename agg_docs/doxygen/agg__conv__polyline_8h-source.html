<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>agg_conv_polyline.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>agg_conv_polyline.h</h1><a href="agg__conv__polyline_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------------</font>
00002 <font class="comment">// Anti-Grain Geometry - Version 2.0 </font>
00003 <font class="comment">// Copyright (C) 2002 Maxim Shemanarev (McSeem)</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Permission to copy, use, modify, sell and distribute this software </font>
00006 <font class="comment">// is granted provided this copyright notice appears in all copies. </font>
00007 <font class="comment">// This software is provided "as is" without express or implied</font>
00008 <font class="comment">// warranty, and with no claim as to its suitability for any purpose.</font>
00009 <font class="comment">//</font>
00010 <font class="comment">//----------------------------------------------------------------------------</font>
00011 <font class="comment">// Contact: mcseem@antigrain.com</font>
00012 <font class="comment">//          mcseemagg@yahoo.com</font>
00013 <font class="comment">//          http://www.antigrain.com</font>
00014 <font class="comment">//----------------------------------------------------------------------------</font>
00015 <font class="comment">//</font>
00016 <font class="comment">// class conv_polyline</font>
00017 <font class="comment">//</font>
00018 <font class="comment">//----------------------------------------------------------------------------</font>
00019 
00020 <font class="preprocessor">#ifndef AGG_CONV_POLYLINE_INCLUDED</font>
00021 <font class="preprocessor"></font><font class="preprocessor">#define AGG_CONV_POLYLINE_INCLUDED</font>
00022 <font class="preprocessor"></font>
00023 <font class="preprocessor">#include "<a class="code" href="agg__basics_8h.html">agg_basics.h</a>"</font>
00024 <font class="preprocessor">#include "<a class="code" href="agg__path__storage_8h.html">agg_path_storage.h</a>"</font>
00025 <font class="preprocessor">#include "<a class="code" href="agg__math_8h.html">agg_math.h</a>"</font>
00026 
00027 <font class="keyword">namespace </font>agg
00028 {
00029 
00030     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00031"></a><a class="code" href="classagg_1_1conv__polyline.html">00031</a>     <font class="keyword">template</font>&lt;<font class="keyword">class</font> VertexSource&gt; <font class="keyword">class </font>conv_polyline
00032     {
<a name="l00033"></a><a class="code" href="classagg_1_1conv__polyline.html#u4">00033</a>         <font class="keyword">enum</font> <a class="code" href="classagg_1_1conv__polyline.html#u4">status</a>
00034         {
00035             <a class="code" href="classagg_1_1conv__polyline.html#u4u0">initial</a>,
00036             <a class="code" href="classagg_1_1conv__polyline.html#u4u1">accumulate</a>,
00037             <a class="code" href="classagg_1_1conv__polyline.html#u4u2">outline1</a>,
00038             <a class="code" href="classagg_1_1conv__polyline.html#u4u3">outline2</a>
00039         };
00040 
00041     <font class="keyword">public</font>:
<a name="l00042"></a><a class="code" href="classagg_1_1conv__polyline.html#a0">00042</a>         <a class="code" href="classagg_1_1conv__polyline.html#a0">conv_polyline</a>(VertexSource* source, <font class="keywordtype">double</font> thickness=1.0) :
00043           <a class="code" href="classagg_1_1conv__polyline.html#o0">m_source</a>(source), 
00044           <a class="code" href="classagg_1_1conv__polyline.html#o2">m_status</a>(<a class="code" href="classagg_1_1conv__polyline.html#u4u0">initial</a>), 
00045           <a class="code" href="classagg_1_1conv__polyline.html#o3">m_thickness</a>(thickness / 2.0), 
00046           <a class="code" href="classagg_1_1conv__polyline.html#o6">m_last_flag</a>(<a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>),
00047           <a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a>(0)
00048         { }
00049 
00050 
<a name="l00051"></a><a class="code" href="classagg_1_1conv__polyline.html#a1">00051</a>         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1conv__polyline.html#a1">set_thickness</a>(<font class="keywordtype">double</font> thickness)
00052         {
00053             <a class="code" href="classagg_1_1conv__polyline.html#o3">m_thickness</a> = thickness / 2.0;
00054         }
00055 
<a name="l00056"></a><a class="code" href="classagg_1_1conv__polyline.html#a2">00056</a>         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1conv__polyline.html#a2">reset_iterator</a>(<font class="keywordtype">unsigned</font> start) 
00057         { 
00058             <a class="code" href="classagg_1_1conv__polyline.html#o0">m_source</a>-&gt;reset_iterator(start); 
00059             <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.remove_all();
00060             <a class="code" href="classagg_1_1conv__polyline.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polyline.html#u4u0">initial</a>;
00061             <a class="code" href="classagg_1_1conv__polyline.html#o6">m_last_flag</a> = <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>;
00062             <a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a> = 0;
00063         }
00064 
00065         <a class="code" href="namespaceagg.html#a63">pathflag_e</a> <a class="code" href="classagg_1_1conv__polyline.html#a3">next_vertex</a>(<font class="keywordtype">double</font>* x, <font class="keywordtype">double</font>* y);
00066 
00067     <font class="keyword">private</font>:
00068         <a class="code" href="namespaceagg.html#a63">pathflag_e</a>  <a class="code" href="classagg_1_1conv__polyline.html#c0">calculate</a>(<font class="keywordtype">unsigned</font> prev,
00069                               <font class="keywordtype">unsigned</font> curr,
00070                               <font class="keywordtype">unsigned</font> next,
00071                               <font class="keywordtype">double</font> *x, 
00072                               <font class="keywordtype">double</font> *y, 
00073                               <font class="keywordtype">double</font> thickness);
00074 
00075     <font class="keyword">private</font>:
<a name="l00076"></a><a class="code" href="classagg_1_1conv__polyline.html#o0">00076</a>         VertexSource* <a class="code" href="classagg_1_1conv__polyline.html#o0">m_source</a>;
<a name="l00077"></a><a class="code" href="classagg_1_1conv__polyline.html#o1">00077</a>         path_storage  <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>;
<a name="l00078"></a><a class="code" href="classagg_1_1conv__polyline.html#o2">00078</a>         <a class="code" href="classagg_1_1conv__polyline.html#u4">status</a>        <a class="code" href="classagg_1_1conv__polyline.html#o2">m_status</a>;
<a name="l00079"></a><a class="code" href="classagg_1_1conv__polyline.html#o3">00079</a>         <font class="keywordtype">double</font>        <a class="code" href="classagg_1_1conv__polyline.html#o3">m_thickness</a>;
<a name="l00080"></a><a class="code" href="classagg_1_1conv__polyline.html#o4">00080</a>         <font class="keywordtype">double</font>        <a class="code" href="classagg_1_1conv__polyline.html#o4">m_start_x</a>;
<a name="l00081"></a><a class="code" href="classagg_1_1conv__polyline.html#o5">00081</a>         <font class="keywordtype">double</font>        <a class="code" href="classagg_1_1conv__polyline.html#o5">m_start_y</a>;
<a name="l00082"></a><a class="code" href="classagg_1_1conv__polyline.html#o6">00082</a>         <a class="code" href="namespaceagg.html#a63">pathflag_e</a>    <a class="code" href="classagg_1_1conv__polyline.html#o6">m_last_flag</a>;
<a name="l00083"></a><a class="code" href="classagg_1_1conv__polyline.html#o7">00083</a>         <font class="keywordtype">unsigned</font>      <a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a>;
00084     };
00085 
00086 
00087 
00088 
00089 
00090     <font class="comment">//------------------------------------------------------------------------</font>
00091     <font class="keyword">template</font>&lt;<font class="keyword">class</font> VertexSource&gt; 
<a name="l00092"></a><a class="code" href="classagg_1_1conv__polyline.html#c0">00092</a>     <a class="code" href="namespaceagg.html#a63">pathflag_e</a> conv_polyline&lt;VertexSource&gt;::calculate(<font class="keywordtype">unsigned</font> prev,
00093                                                       <font class="keywordtype">unsigned</font> curr,
00094                                                       <font class="keywordtype">unsigned</font> next,
00095                                                       <font class="keywordtype">double</font> *x, 
00096                                                       <font class="keywordtype">double</font> *y, 
00097                                                       <font class="keywordtype">double</font> thickness)
00098     {
00099         <font class="keywordtype">double</font> x0, y0, x2, y2, dx1, dy1, dx2, dy2;
00100 
00101         <a class="code" href="namespaceagg.html#a63">pathflag_e</a> flag = <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.get_vertex(curr, x, y);
00102         <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.get_vertex(prev, &amp;x0, &amp;y0);
00103         <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.get_vertex(next, &amp;x2, &amp;y2);
00104 
00105         <a class="code" href="namespaceagg.html#a53">calc_orthogonal</a>(thickness, x0, y0, *x, *y, &amp;dx1, &amp;dy1);
00106         <a class="code" href="namespaceagg.html#a53">calc_orthogonal</a>(thickness, *x, *y, x2, y2, &amp;dx2, &amp;dy2);
00107 
00108         <font class="keywordflow">if</font>(curr == 0)
00109         {
00110             <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polyline.html#o2">m_status</a> == <a class="code" href="classagg_1_1conv__polyline.html#u4u2">outline1</a>)
00111             {
00112                 *x += dx2 - dy2;
00113                 *y -= dy2 + dx2;
00114             }
00115             <font class="keywordflow">else</font>
00116             {
00117                 *x += dx1 + dy1;
00118                 *y -= dy1 - dx1;
00119             }
00120             <font class="keywordflow">return</font> flag;
00121         }
00122 
00123         <font class="keywordflow">if</font>(curr == <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.total_vertices() - 1)
00124         {
00125             <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polyline.html#o2">m_status</a> == <a class="code" href="classagg_1_1conv__polyline.html#u4u2">outline1</a>)
00126             {
00127                 *x += dx1 + dy1;
00128                 *y -= dy1 - dx1;
00129             }
00130             <font class="keywordflow">else</font>
00131             {
00132                 *x += dx2 - dy2;
00133                 *y -= dy2 + dx2;
00134             }
00135             <font class="keywordflow">return</font> flag;
00136         }
00137 
00138         <font class="keywordflow">if</font>(!<a class="code" href="namespaceagg.html#a52">calc_intersection</a>(x0 + dx1, y0 - dy1,
00139                               *x + dx1, *y - dy1,
00140                               *x + dx2, *y - dy2,
00141                               x2 + dx2, y2 - dy2,
00142                               x, y))
00143         {
00144             *x += dx1;
00145             *y -= dy1;
00146         }
00147         <font class="keywordflow">return</font> flag;
00148     }
00149 
00150 
00151 
00152     <font class="comment">//------------------------------------------------------------------------</font>
00153     <font class="keyword">template</font>&lt;<font class="keyword">class</font> VertexSource&gt; 
<a name="l00154"></a><a class="code" href="classagg_1_1conv__polyline.html#a3">00154</a>     <a class="code" href="namespaceagg.html#a63">pathflag_e</a> conv_polyline&lt;VertexSource&gt;::next_vertex(<font class="keywordtype">double</font>* x, <font class="keywordtype">double</font>* y)
00155     {
00156         <a class="code" href="namespaceagg.html#a63">pathflag_e</a> flag;
00157         <font class="keywordflow">for</font>(;;)
00158         {
00159             <font class="keywordflow">switch</font>(m_status)
00160             {
00161             <font class="keywordflow">case</font> <a class="code" href="classagg_1_1conv__polyline.html#u4u0">initial</a>:
00162                 flag = <a class="code" href="classagg_1_1conv__polyline.html#o0">m_source</a>-&gt;next_vertex(&amp;<a class="code" href="classagg_1_1conv__polyline.html#o4">m_start_x</a>, &amp;<a class="code" href="classagg_1_1conv__polyline.html#o5">m_start_y</a>);
00163                 <a class="code" href="classagg_1_1conv__polyline.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polyline.html#u4u1">accumulate</a>;
00164 
00165             <font class="keywordflow">case</font> <a class="code" href="classagg_1_1conv__polyline.html#u4u1">accumulate</a>:
00166                 <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polyline.html#o6">m_last_flag</a> == <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>) <font class="keywordflow">return</font> <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>;
00167                 <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.remove_all();
00168 
00169                 <font class="keywordflow">for</font>(;;)
00170                 {
00171                     flag = <a class="code" href="classagg_1_1conv__polyline.html#o6">m_last_flag</a> = <a class="code" href="classagg_1_1conv__polyline.html#o0">m_source</a>-&gt;next_vertex(x, y);
00172                     <font class="keywordflow">if</font>(flag != <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>) <font class="keywordflow">break</font>;
00173                     <a class="code" href="classagg_1_1conv__polyline.html#o4">m_start_x</a> = *x;
00174                     <a class="code" href="classagg_1_1conv__polyline.html#o5">m_start_y</a> = *y;
00175                 }
00176 
00177                 <font class="keywordflow">if</font>(flag == <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>) <font class="keywordflow">break</font>;
00178 
00179                 <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.line_to(<a class="code" href="classagg_1_1conv__polyline.html#o4">m_start_x</a>, <a class="code" href="classagg_1_1conv__polyline.html#o5">m_start_y</a>);
00180                 <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.line_to(*x, *y);
00181                 <font class="keywordflow">for</font>(;;)
00182                 {
00183                     <a class="code" href="classagg_1_1conv__polyline.html#o6">m_last_flag</a> = flag = <a class="code" href="classagg_1_1conv__polyline.html#o0">m_source</a>-&gt;next_vertex(x, y);
00184                     <font class="keywordflow">if</font>(flag == <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>)
00185                     {
00186                         <font class="keywordflow">break</font>;
00187                     }
00188                     <font class="keywordflow">if</font>(flag == <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>)
00189                     {
00190                         <a class="code" href="classagg_1_1conv__polyline.html#o4">m_start_x</a> = *x;
00191                         <a class="code" href="classagg_1_1conv__polyline.html#o5">m_start_y</a> = *y;
00192                         <font class="keywordflow">break</font>;
00193                     }
00194                     <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.add_vertex(*x, *y, flag);
00195                 }
00196                 <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.filter_vertices(<font class="keyword">false</font>);
00197                 <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.total_vertices() &lt; 2) <font class="keywordflow">break</font>;
00198                 <a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a> = 0;
00199                 <a class="code" href="classagg_1_1conv__polyline.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polyline.html#u4u2">outline1</a>;
00200 
00201             <font class="keywordflow">case</font> <a class="code" href="classagg_1_1conv__polyline.html#u4u2">outline1</a>:
00202                 <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a> &gt;= <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.total_vertices())
00203                 {
00204                     <a class="code" href="classagg_1_1conv__polyline.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polyline.html#u4u3">outline2</a>;
00205                     <font class="keywordflow">break</font>;
00206                 }
00207                 flag = <a class="code" href="classagg_1_1conv__polyline.html#c0">calculate</a>((<a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a> + <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.total_vertices() - 1) % <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.total_vertices(),
00208                                   <a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a>, 
00209                                   (<a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a> + 1) % <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.total_vertices(), 
00210                                   x, y, <a class="code" href="classagg_1_1conv__polyline.html#o3">m_thickness</a>);
00211                 ++<a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a>;
00212                 <font class="keywordflow">return</font> (<a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a> == 1) ? <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a> : flag;
00213 
00214             <font class="keywordflow">case</font> <a class="code" href="classagg_1_1conv__polyline.html#u4u3">outline2</a>:
00215                 <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a> == 0)
00216                 {
00217                     <a class="code" href="classagg_1_1conv__polyline.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polyline.html#u4u1">accumulate</a>;
00218                     <font class="keywordflow">break</font>;
00219                 }
00220                 --<a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a>;
00221                 flag = <a class="code" href="classagg_1_1conv__polyline.html#c0">calculate</a>((<a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a> + 1) % <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.total_vertices(), 
00222                                   <a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a>, 
00223                                   (<a class="code" href="classagg_1_1conv__polyline.html#o7">m_curr_idx</a> + <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.total_vertices() - 1) % <a class="code" href="classagg_1_1conv__polyline.html#o1">m_accumulator</a>.total_vertices(),
00224                                   x, y, <a class="code" href="classagg_1_1conv__polyline.html#o3">m_thickness</a>);
00225                 <font class="keywordflow">return</font> flag;
00226             }
00227         }
00228         <font class="keywordflow">return</font> flag;
00229     }
00230 
00231 
00232 
00233 
00234 }
00235 
00236 
00237 <font class="preprocessor">#endif</font>
00238 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated on Tue Apr 23 09:06:33 2002 for AGG v2.0 beta by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
