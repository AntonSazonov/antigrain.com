<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>agg_conv_polygon.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>agg_conv_polygon.h</h1><a href="agg__conv__polygon_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------------</font>
00002 <font class="comment">// Anti-Grain Geometry - Version 2.0 </font>
00003 <font class="comment">// Copyright (C) 2002 Maxim Shemanarev (McSeem)</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Permission to copy, use, modify, sell and distribute this software </font>
00006 <font class="comment">// is granted provided this copyright notice appears in all copies. </font>
00007 <font class="comment">// This software is provided "as is" without express or implied</font>
00008 <font class="comment">// warranty, and with no claim as to its suitability for any purpose.</font>
00009 <font class="comment">//</font>
00010 <font class="comment">//----------------------------------------------------------------------------</font>
00011 <font class="comment">// Contact: mcseem@antigrain.com</font>
00012 <font class="comment">//          mcseemagg@yahoo.com</font>
00013 <font class="comment">//          http://www.antigrain.com</font>
00014 <font class="comment">//----------------------------------------------------------------------------</font>
00015 <font class="comment">//</font>
00016 <font class="comment">// class conv_polygon</font>
00017 <font class="comment">//</font>
00018 <font class="comment">//----------------------------------------------------------------------------</font>
00019 
00020 <font class="preprocessor">#ifndef AGG_CONV_POLYGON_INCLUDED</font>
00021 <font class="preprocessor"></font><font class="preprocessor">#define AGG_CONV_POLYGON_INCLUDED</font>
00022 <font class="preprocessor"></font>
00023 <font class="preprocessor">#include "<a class="code" href="agg__basics_8h.html">agg_basics.h</a>"</font>
00024 <font class="preprocessor">#include "<a class="code" href="agg__path__storage_8h.html">agg_path_storage.h</a>"</font>
00025 <font class="preprocessor">#include "<a class="code" href="agg__math_8h.html">agg_math.h</a>"</font>
00026 
00027 <font class="keyword">namespace </font>agg
00028 {
00029 
00030     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00031"></a><a class="code" href="classagg_1_1conv__polygon.html">00031</a>     <font class="keyword">template</font>&lt;<font class="keyword">class</font> VertexSource&gt; <font class="keyword">class </font>conv_polygon
00032     {
<a name="l00033"></a><a class="code" href="classagg_1_1conv__polygon.html#u4">00033</a>         <font class="keyword">enum</font> <a class="code" href="classagg_1_1conv__polygon.html#u4">status</a>
00034         {
00035             <a class="code" href="classagg_1_1conv__polygon.html#u4u0">initial</a>,
00036             <a class="code" href="classagg_1_1conv__polygon.html#u4u1">accumulate</a>,
00037             <a class="code" href="classagg_1_1conv__polygon.html#u4u2">outline1</a>,
00038             <a class="code" href="classagg_1_1conv__polygon.html#u4u3">outline2</a>
00039         };
00040 
00041     <font class="keyword">public</font>:
<a name="l00042"></a><a class="code" href="classagg_1_1conv__polygon.html#a0">00042</a>         <a class="code" href="classagg_1_1conv__polygon.html#a0">conv_polygon</a>(VertexSource* source, <font class="keywordtype">double</font> thickness=1.0) :
00043           <a class="code" href="classagg_1_1conv__polygon.html#o0">m_source</a>(source), 
00044           <a class="code" href="classagg_1_1conv__polygon.html#o2">m_status</a>(<a class="code" href="classagg_1_1conv__polygon.html#u4u0">initial</a>), 
00045           <a class="code" href="classagg_1_1conv__polygon.html#o3">m_thickness</a>(thickness / 2.0), 
00046           <a class="code" href="classagg_1_1conv__polygon.html#o6">m_last_flag</a>(<a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>),
00047           <a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a>(0)
00048         { }
00049 
00050 
<a name="l00051"></a><a class="code" href="classagg_1_1conv__polygon.html#a1">00051</a>         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1conv__polygon.html#a1">set_thickness</a>(<font class="keywordtype">double</font> thickness)
00052         {
00053             <a class="code" href="classagg_1_1conv__polygon.html#o3">m_thickness</a> = thickness / 2.0;
00054         }
00055 
<a name="l00056"></a><a class="code" href="classagg_1_1conv__polygon.html#a2">00056</a>         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1conv__polygon.html#a2">reset_iterator</a>(<font class="keywordtype">unsigned</font> start) 
00057         { 
00058             <a class="code" href="classagg_1_1conv__polygon.html#o0">m_source</a>-&gt;reset_iterator(start); 
00059             <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.remove_all();
00060             <a class="code" href="classagg_1_1conv__polygon.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polygon.html#u4u0">initial</a>;
00061             <a class="code" href="classagg_1_1conv__polygon.html#o6">m_last_flag</a> = <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>;
00062             <a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> = 0;
00063         }
00064 
00065         <a class="code" href="namespaceagg.html#a63">pathflag_e</a> <a class="code" href="classagg_1_1conv__polygon.html#a3">next_vertex</a>(<font class="keywordtype">double</font>* x, <font class="keywordtype">double</font>* y);
00066 
00067     <font class="keyword">private</font>:
00068         <a class="code" href="namespaceagg.html#a63">pathflag_e</a> <a class="code" href="classagg_1_1conv__polygon.html#c0">calculate</a>(<font class="keywordtype">unsigned</font> prev,
00069                              <font class="keywordtype">unsigned</font> curr,
00070                              <font class="keywordtype">unsigned</font> next,
00071                              <font class="keywordtype">double</font> *x, 
00072                              <font class="keywordtype">double</font> *y, 
00073                              <font class="keywordtype">double</font> thickness);
00074 
00075     <font class="keyword">private</font>:
<a name="l00076"></a><a class="code" href="classagg_1_1conv__polygon.html#o0">00076</a>         VertexSource* <a class="code" href="classagg_1_1conv__polygon.html#o0">m_source</a>;
<a name="l00077"></a><a class="code" href="classagg_1_1conv__polygon.html#o1">00077</a>         path_storage  <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>;
<a name="l00078"></a><a class="code" href="classagg_1_1conv__polygon.html#o2">00078</a>         <a class="code" href="classagg_1_1conv__polygon.html#u4">status</a>        <a class="code" href="classagg_1_1conv__polygon.html#o2">m_status</a>;
<a name="l00079"></a><a class="code" href="classagg_1_1conv__polygon.html#o3">00079</a>         <font class="keywordtype">double</font>        <a class="code" href="classagg_1_1conv__polygon.html#o3">m_thickness</a>;
<a name="l00080"></a><a class="code" href="classagg_1_1conv__polygon.html#o4">00080</a>         <font class="keywordtype">double</font>        <a class="code" href="classagg_1_1conv__polygon.html#o4">m_start_x</a>;
<a name="l00081"></a><a class="code" href="classagg_1_1conv__polygon.html#o5">00081</a>         <font class="keywordtype">double</font>        <a class="code" href="classagg_1_1conv__polygon.html#o5">m_start_y</a>;
<a name="l00082"></a><a class="code" href="classagg_1_1conv__polygon.html#o6">00082</a>         <a class="code" href="namespaceagg.html#a63">pathflag_e</a>    <a class="code" href="classagg_1_1conv__polygon.html#o6">m_last_flag</a>;
<a name="l00083"></a><a class="code" href="classagg_1_1conv__polygon.html#o7">00083</a>         <font class="keywordtype">unsigned</font>      <a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a>;
00084     };
00085 
00086 
00087 
00088 
00089     <font class="comment">//------------------------------------------------------------------------</font>
00090     <font class="keyword">template</font>&lt;<font class="keyword">class</font> VertexSource&gt; 
<a name="l00091"></a><a class="code" href="classagg_1_1conv__polygon.html#c0">00091</a>     <a class="code" href="namespaceagg.html#a63">pathflag_e</a> conv_polygon&lt;VertexSource&gt;::calculate(<font class="keywordtype">unsigned</font> prev,
00092                                                      <font class="keywordtype">unsigned</font> curr,
00093                                                      <font class="keywordtype">unsigned</font> next,
00094                                                      <font class="keywordtype">double</font> *x, 
00095                                                      <font class="keywordtype">double</font> *y, 
00096                                                      <font class="keywordtype">double</font> thickness)
00097     {
00098         <font class="keywordtype">double</font> x0, y0, x2, y2, dx1, dy1, dx2, dy2;
00099         <a class="code" href="namespaceagg.html#a63">pathflag_e</a> flag = <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.get_vertex(curr, x, y);
00100         <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.get_vertex(prev, &amp;x0, &amp;y0);
00101         <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.get_vertex(next, &amp;x2, &amp;y2);
00102 
00103         <a class="code" href="namespaceagg.html#a53">calc_orthogonal</a>(thickness, x0, y0, *x, *y, &amp;dx1, &amp;dy1);
00104         <a class="code" href="namespaceagg.html#a53">calc_orthogonal</a>(thickness, *x, *y, x2, y2, &amp;dx2, &amp;dy2);
00105 
00106         <font class="keywordflow">if</font>(!<a class="code" href="namespaceagg.html#a52">calc_intersection</a>(x0 + dx1, y0 - dy1,
00107                               *x + dx1, *y - dy1,
00108                               *x + dx2, *y - dy2,
00109                               x2 + dx2, y2 - dy2,
00110                               x, y))
00111         {
00112             *x += dx1;
00113             *y -= dy1;
00114         }
00115         <font class="keywordflow">return</font> flag;
00116     }
00117 
00118 
00119 
00120 
00121 
00122     <font class="comment">//------------------------------------------------------------------------</font>
00123     <font class="keyword">template</font>&lt;<font class="keyword">class</font> VertexSource&gt; 
<a name="l00124"></a><a class="code" href="classagg_1_1conv__polygon.html#a3">00124</a>     <a class="code" href="namespaceagg.html#a63">pathflag_e</a> conv_polygon&lt;VertexSource&gt;::next_vertex(<font class="keywordtype">double</font>* x, <font class="keywordtype">double</font>* y)
00125     {
00126         <a class="code" href="namespaceagg.html#a63">pathflag_e</a> flag;
00127         <font class="keywordflow">for</font>(;;)
00128         {
00129             <font class="keywordflow">switch</font>(m_status)
00130             {
00131             <font class="keywordflow">case</font> <a class="code" href="classagg_1_1conv__polygon.html#u4u0">initial</a>:
00132                 flag = <a class="code" href="classagg_1_1conv__polygon.html#o0">m_source</a>-&gt;next_vertex(&amp;<a class="code" href="classagg_1_1conv__polygon.html#o4">m_start_x</a>, &amp;<a class="code" href="classagg_1_1conv__polygon.html#o5">m_start_y</a>);
00133                 <a class="code" href="classagg_1_1conv__polygon.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polygon.html#u4u1">accumulate</a>;
00134 
00135             <font class="keywordflow">case</font> <a class="code" href="classagg_1_1conv__polygon.html#u4u1">accumulate</a>:
00136                 <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polygon.html#o6">m_last_flag</a> == <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>) <font class="keywordflow">return</font> <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>;
00137                 <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.remove_all();
00138 
00139                 <font class="keywordflow">for</font>(;;)
00140                 {
00141                     flag = <a class="code" href="classagg_1_1conv__polygon.html#o6">m_last_flag</a> = <a class="code" href="classagg_1_1conv__polygon.html#o0">m_source</a>-&gt;next_vertex(x, y);
00142                     <font class="keywordflow">if</font>(flag != <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>) <font class="keywordflow">break</font>;
00143                     <a class="code" href="classagg_1_1conv__polygon.html#o4">m_start_x</a> = *x;
00144                     <a class="code" href="classagg_1_1conv__polygon.html#o5">m_start_y</a> = *y;
00145                 }
00146                 
00147                 <font class="keywordflow">if</font>(flag == <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>) <font class="keywordflow">break</font>;
00148                 <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.line_to(<a class="code" href="classagg_1_1conv__polygon.html#o4">m_start_x</a>, <a class="code" href="classagg_1_1conv__polygon.html#o5">m_start_y</a>);
00149                 <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.line_to(*x, *y);
00150                 <font class="keywordflow">for</font>(;;)
00151                 {
00152                     <a class="code" href="classagg_1_1conv__polygon.html#o6">m_last_flag</a> = flag = <a class="code" href="classagg_1_1conv__polygon.html#o0">m_source</a>-&gt;next_vertex(x, y);
00153                     <font class="keywordflow">if</font>(flag == <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>)
00154                     {
00155                         <font class="keywordflow">break</font>;
00156                     }
00157                     <font class="keywordflow">if</font>(flag == <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>)
00158                     {
00159                         <a class="code" href="classagg_1_1conv__polygon.html#o4">m_start_x</a> = *x;
00160                         <a class="code" href="classagg_1_1conv__polygon.html#o5">m_start_y</a> = *y;
00161                         <font class="keywordflow">break</font>;
00162                     }
00163                     <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.add_vertex(*x, *y, flag);
00164                 }
00165                 <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.filter_vertices(<font class="keyword">true</font>);
00166                 <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.total_vertices() &lt; 3) <font class="keywordflow">break</font>;
00167                 <a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> = 0;
00168                 <a class="code" href="classagg_1_1conv__polygon.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polygon.html#u4u2">outline1</a>;
00169 
00170             <font class="keywordflow">case</font> <a class="code" href="classagg_1_1conv__polygon.html#u4u2">outline1</a>:
00171                 <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> &gt;= <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.total_vertices())
00172                 {
00173                     <a class="code" href="classagg_1_1conv__polygon.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polygon.html#u4u3">outline2</a>;
00174                     <font class="keywordflow">break</font>;
00175                 }
00176                 flag = <a class="code" href="classagg_1_1conv__polygon.html#c0">calculate</a>((<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> + <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.total_vertices() - 1) % <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.total_vertices(),
00177                                  <a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a>, 
00178                                  (<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> + 1) % <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.total_vertices(), 
00179                                  x, y, <a class="code" href="classagg_1_1conv__polygon.html#o3">m_thickness</a>);
00180                 ++<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a>;
00181                 <font class="keywordflow">return</font> (<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> == 1) ? <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a> : flag;
00182 
00183             <font class="keywordflow">case</font> <a class="code" href="classagg_1_1conv__polygon.html#u4u3">outline2</a>:
00184                 <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> == 0)
00185                 {
00186                     <a class="code" href="classagg_1_1conv__polygon.html#o2">m_status</a> = <a class="code" href="classagg_1_1conv__polygon.html#u4u1">accumulate</a>;
00187                     <font class="keywordflow">break</font>;
00188                 }
00189                 --<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a>;
00190                 flag = <a class="code" href="classagg_1_1conv__polygon.html#c0">calculate</a>((<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> + 1) % <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.total_vertices(), 
00191                                  <a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a>, 
00192                                  (<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> + <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.total_vertices() - 1) % <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.total_vertices(),
00193                                  x, y, <a class="code" href="classagg_1_1conv__polygon.html#o3">m_thickness</a>);
00194                 <font class="keywordflow">return</font> (<a class="code" href="classagg_1_1conv__polygon.html#o7">m_curr_idx</a> == <a class="code" href="classagg_1_1conv__polygon.html#o1">m_accumulator</a>.total_vertices() - 1) ? <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a> : flag;
00195             }
00196         }
00197         <font class="keywordflow">return</font> flag;
00198     }
00199 
00200 
00201 
00202 
00203 }
00204 
00205 <font class="preprocessor">#endif</font>
</pre></div><hr><address><small>Generated on Tue Apr 23 09:06:33 2002 for AGG v2.0 beta by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
