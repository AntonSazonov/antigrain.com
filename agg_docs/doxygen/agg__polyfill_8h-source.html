<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>agg_polyfill.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>agg_polyfill.h</h1><a href="agg__polyfill_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------------</font>
00002 <font class="comment">// Anti-Grain Geometry - Version 2.0 </font>
00003 <font class="comment">// Copyright (C) 2002 Maxim Shemanarev (McSeem)</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Permission to copy, use, modify, sell and distribute this software </font>
00006 <font class="comment">// is granted provided this copyright notice appears in all copies. </font>
00007 <font class="comment">// This software is provided "as is" without express or implied</font>
00008 <font class="comment">// warranty, and with no claim as to its suitability for any purpose.</font>
00009 <font class="comment">//</font>
00010 <font class="comment">// The author gratefully acknowleges the support of David Turner, </font>
00011 <font class="comment">// Robert Wilhelm, and Werner Lemberg - the authors of the FreeType </font>
00012 <font class="comment">// libray - in producing this work. See http://www.freetype.org for details.</font>
00013 <font class="comment">//</font>
00014 <font class="comment">//----------------------------------------------------------------------------</font>
00015 <font class="comment">// Contact: mcseem@antigrain.com</font>
00016 <font class="comment">//          mcseemagg@yahoo.com</font>
00017 <font class="comment">//          http://www.antigrain.com</font>
00018 <font class="comment">//----------------------------------------------------------------------------</font>
00019 <font class="comment">//</font>
00020 <font class="comment">// Classes polyfill</font>
00021 <font class="comment">//         </font>
00022 <font class="comment">//</font>
00023 <font class="comment">//----------------------------------------------------------------------------</font>
00024 <font class="preprocessor">#ifndef AGG_OUTLINE_INCLUDED</font>
00025 <font class="preprocessor"></font><font class="preprocessor">#define AGG_OUTLINE_INCLUDED</font>
00026 <font class="preprocessor"></font>
00027 
00028 <font class="preprocessor">#include "<a class="code" href="agg__basics_8h.html">agg_basics.h</a>"</font>
00029 <font class="preprocessor">#include "<a class="code" href="agg__scanline_8h.html">agg_scanline.h</a>"</font>
00030 
00031 <font class="keyword">namespace </font>agg
00032 {
00033     <font class="comment">//------------------------------------------------------------------------</font>
00034     <font class="keyword">enum</font> <a class="code" href="namespaceagg.html#a65">polyfill_flags</a>
00035     {
00036         <a class="code" href="namespaceagg.html#a65a35">non_zero_fill</a> = 0,
00037         <a class="code" href="namespaceagg.html#a65a36">even_odd_fill</a> = 1
00038     };
00039 
00040 
00041     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00042"></a><a class="code" href="structagg_1_1cell.html">00042</a>     <font class="keyword">struct </font>cell
00043     {
<a name="l00044"></a><a class="code" href="structagg_1_1cell.html#m0">00044</a>         <a class="code" href="namespaceagg.html#a6">int16</a> <a class="code" href="structagg_1_1cell.html#m0">x</a>;
<a name="l00045"></a><a class="code" href="structagg_1_1cell.html#m1">00045</a>         <a class="code" href="namespaceagg.html#a6">int16</a> <a class="code" href="structagg_1_1cell.html#m1">y</a>;
<a name="l00046"></a><a class="code" href="structagg_1_1cell.html#m2">00046</a>         <font class="keywordtype">int</font>   <a class="code" href="structagg_1_1cell.html#m2">packed_coord</a>;
<a name="l00047"></a><a class="code" href="structagg_1_1cell.html#m3">00047</a>         <font class="keywordtype">int</font>   <a class="code" href="structagg_1_1cell.html#m3">cover</a>;
<a name="l00048"></a><a class="code" href="structagg_1_1cell.html#m4">00048</a>         <font class="keywordtype">int</font>   <a class="code" href="structagg_1_1cell.html#m4">area</a>;
00049 
00050         <font class="keywordtype">void</font> <a class="code" href="structagg_1_1cell.html#a0">set</a>(<font class="keywordtype">int</font> <a class="code" href="structagg_1_1cell.html#m0">x</a>, <font class="keywordtype">int</font> <a class="code" href="structagg_1_1cell.html#m1">y</a>, <font class="keywordtype">int</font> c, <font class="keywordtype">int</font> a);
00051         <font class="keywordtype">void</font> <a class="code" href="structagg_1_1cell.html#a1">set_coord</a>(<font class="keywordtype">int</font> <a class="code" href="structagg_1_1cell.html#m0">x</a>, <font class="keywordtype">int</font> <a class="code" href="structagg_1_1cell.html#m1">y</a>);
00052         <font class="keywordtype">void</font> <a class="code" href="structagg_1_1cell.html#a2">set_cover</a>(<font class="keywordtype">int</font> c, <font class="keywordtype">int</font> a);
00053         <font class="keywordtype">void</font> <a class="code" href="structagg_1_1cell.html#a3">add_cover</a>(<font class="keywordtype">int</font> c, <font class="keywordtype">int</font> a);
00054     };
00055 
00056 
00057     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00058"></a><a class="code" href="classagg_1_1cell__iterator.html">00058</a>     <font class="keyword">class </font>cell_iterator
00059     {
00060     <font class="keyword">public</font>:
<a name="l00061"></a><a class="code" href="classagg_1_1cell__iterator.html#a0">00061</a>         <a class="code" href="classagg_1_1cell__iterator.html#a0">cell_iterator</a>(<font class="keyword">const</font> cell* <font class="keyword">const</font>* storage) :
00062             <a class="code" href="classagg_1_1cell__iterator.html#o0">m_null_cell</a>(0),
00063             <a class="code" href="classagg_1_1cell__iterator.html#o1">m_cur_cell_ptr</a>(storage ? storage - 1 : (&amp;<a class="code" href="classagg_1_1cell__iterator.html#o0">m_null_cell</a>) - 1)
00064             {}
<a name="l00065"></a><a class="code" href="classagg_1_1cell__iterator.html#a1">00065</a>         <font class="keyword">const</font> cell* <a class="code" href="classagg_1_1cell__iterator.html#a1">get_next</a>() { <font class="keywordflow">return</font> *++<a class="code" href="classagg_1_1cell__iterator.html#o1">m_cur_cell_ptr</a>; }
00066 
00067     <font class="keyword">private</font>:
<a name="l00068"></a><a class="code" href="classagg_1_1cell__iterator.html#o0">00068</a>         <font class="keyword">const</font> cell*         <a class="code" href="classagg_1_1cell__iterator.html#o0">m_null_cell</a>;
<a name="l00069"></a><a class="code" href="classagg_1_1cell__iterator.html#o1">00069</a>         <font class="keyword">const</font> cell* <font class="keyword">const</font>*  <a class="code" href="classagg_1_1cell__iterator.html#o1">m_cur_cell_ptr</a>;
00070     };
00071 
00072 
00073     <font class="comment">//========================================================================</font>
00074     <font class="comment">// Polygon renderer. Low-level class used to render filled polygons with</font>
00075     <font class="comment">// high-quality Anti-Aliasing. The class uses integer coordinates in </font>
00076     <font class="comment">// format 24.8, i.e. 24 bits for integer part and 8 bits for fractional - see</font>
00077     <font class="comment">// poly_base_shift in agg_basics.h. This class can be used in the following </font>
00078     <font class="comment">// way:</font>
00079     <font class="comment">// 1. set_flags(flags) - optional.</font>
00080     <font class="comment">//</font>
00081     <font class="comment">// 2. set_gamma(gamma) - optional.</font>
00082     <font class="comment">//</font>
00083     <font class="comment">// 3. reset()</font>
00084     <font class="comment">//</font>
00085     <font class="comment">// 4. move_to(x, y) / line_to(x, y) - make the polygon. One can create </font>
00086     <font class="comment">//    more than one contour, but each contour must consist of at least 3</font>
00087     <font class="comment">//    vertices, i.e. move_to(x1, y1); line_to(x2, y2); line_to(x3, y3);</font>
00088     <font class="comment">//    is the absolute minimum of vertices that defines a triangle.</font>
00089     <font class="comment">//    The algorithm does not check either the number of vertices nor</font>
00090     <font class="comment">//    coincidence of their coordinates, but in the worst case it just </font>
00091     <font class="comment">//    won't draw anything.</font>
00092     <font class="comment">//    The orger of the vertices (clockwise or counterclockwise) </font>
00093     <font class="comment">//    is important when using the non-zero winding rule (even_odd_fill </font>
00094     <font class="comment">//    flag is 0, see polyfill_flags). In this case the vertex order of </font>
00095     <font class="comment">//    all the contours must be the same. Not quite. You actually can </font>
00096     <font class="comment">//    use different vertices order. If the contours do not intersect each </font>
00097     <font class="comment">//    other, the order is not important anyway. If they do, contours </font>
00098     <font class="comment">//    with the same order will be rendered following the non-zero </font>
00099     <font class="comment">//    winding rule, while contours with different orders will have "holes"</font>
00100     <font class="comment">//    in the intersection areas, i.e. even-odd rule will be used.</font>
00101     <font class="comment">//</font>
00102     <font class="comment">// 5. get_cells(), get_scanline(), calc_alpha() - "sweep" sorted cell </font>
00103     <font class="comment">//    array. The polyfill will prepare the array of cells if necessary. </font>
00104     <font class="comment">//    The point to divide rendering procedure into the two parts is that </font>
00105     <font class="comment">//    the polyfill class does the major hard work calculating the boundary and</font>
00106     <font class="comment">//    creating the array of cells.</font>
00107     <font class="comment">//    Then one can render the same prepared cell array as many times as needed </font>
00108     <font class="comment">//    with different render classes (solid color, image, color stencil, etc.)</font>
00109     <font class="comment">//    See function render_polygon for details.</font>
00110     <font class="comment">//</font>
00111     <font class="comment">// set_flags() and set_gamma() can be called anytime before "sweeping".</font>
00112     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00113"></a><a class="code" href="classagg_1_1polyfill.html">00113</a>     <font class="keyword">class </font>polyfill
00114     {
00115         <font class="keyword">enum</font>
00116         {
00117             <a class="code" href="classagg_1_1polyfill.html#u5u0">cell_block_shift</a> = 12,
00118             <a class="code" href="classagg_1_1polyfill.html#u5u1">cell_block_size</a>  = 1 &lt;&lt; <a class="code" href="classagg_1_1polyfill.html#u5u0">cell_block_shift</a>,
00119             <a class="code" href="classagg_1_1polyfill.html#u5u2">cell_block_mask</a>  = <a class="code" href="classagg_1_1polyfill.html#u5u1">cell_block_size</a> - 1,
00120             <a class="code" href="classagg_1_1polyfill.html#u5u3">cell_block_pool</a>  = 256,
00121             <a class="code" href="classagg_1_1polyfill.html#u5u4">cell_block_limit</a> = 1024
00122         };
00123 
00124     <font class="keyword">public</font>:
00125 
00126         <a class="code" href="classagg_1_1polyfill.html#a0">~polyfill</a>();
00127         <a class="code" href="classagg_1_1polyfill.html#a1">polyfill</a>();
00128 
00129         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#a2">set_flags</a>(<font class="keywordtype">unsigned</font> flags);
00130         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#a3">set_gamma</a>(<font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>* gamma);
00131 
00132         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#a4">reset</a>();
00133 
00134         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#a5">move_to</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y);
00135         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#a6">line_to</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y);
00136 
00137         <font class="comment">//Render functions </font>
00138         <font class="keyword">const</font> cell* <font class="keyword">const</font>* <a class="code" href="classagg_1_1polyfill.html#a7">get_cells</a>();
00139         scanline* <a class="code" href="classagg_1_1polyfill.html#a8">get_scanline</a>();
00140         <font class="keywordtype">int</font> <a class="code" href="classagg_1_1polyfill.html#a9">calc_alpha</a>(<font class="keywordtype">int</font> area);
00141 
00142 
00143     <font class="keyword">private</font>:
00144         <a class="code" href="classagg_1_1polyfill.html#a1">polyfill</a>(<font class="keyword">const</font> <a class="code" href="classagg_1_1polyfill.html#a1">polyfill</a>&amp;);
00145         <font class="keyword">const</font> <a class="code" href="classagg_1_1polyfill.html#a1">polyfill</a>&amp; <a class="code" href="classagg_1_1polyfill.html#c1">operator = </a>(<font class="keyword">const</font> <a class="code" href="classagg_1_1polyfill.html#a1">polyfill</a>&amp;);
00146 
00147         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#c2">set_cur_cell</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y);
00148         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#c3">add_cur_cell</a>();
00149         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#c4">sort_cells</a>();
00150         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#c5">render_scanline</a>(<font class="keywordtype">int</font> ey, <font class="keywordtype">int</font> x1, <font class="keywordtype">int</font> y1, <font class="keywordtype">int</font> x2, <font class="keywordtype">int</font> y2);
00151         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#c6">render_line</a>(<font class="keywordtype">int</font> x1, <font class="keywordtype">int</font> y1, <font class="keywordtype">int</font> x2, <font class="keywordtype">int</font> y2);
00152         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#c7">add_to_scanline</a>(<font class="keywordtype">int</font> x, <font class="keywordtype">int</font> y, <font class="keywordtype">int</font> area, <font class="keywordtype">int</font> num);
00153         <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#c8">allocate_block</a>();
00154         
00155         <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="classagg_1_1polyfill.html#f0">cell_qsort</a>(cell** start, <font class="keywordtype">unsigned</font> num);
00156 
00157     <font class="keyword">private</font>:
<a name="l00158"></a><a class="code" href="classagg_1_1polyfill.html#o0">00158</a>         <font class="keywordtype">unsigned</font>  <a class="code" href="classagg_1_1polyfill.html#o0">m_num_blocks</a>;
<a name="l00159"></a><a class="code" href="classagg_1_1polyfill.html#o1">00159</a>         <font class="keywordtype">unsigned</font>  <a class="code" href="classagg_1_1polyfill.html#o1">m_max_blocks</a>;
<a name="l00160"></a><a class="code" href="classagg_1_1polyfill.html#o2">00160</a>         <font class="keywordtype">unsigned</font>  <a class="code" href="classagg_1_1polyfill.html#o2">m_cur_block</a>;
<a name="l00161"></a><a class="code" href="classagg_1_1polyfill.html#o3">00161</a>         <font class="keywordtype">unsigned</font>  <a class="code" href="classagg_1_1polyfill.html#o3">m_num_cells</a>;
<a name="l00162"></a><a class="code" href="classagg_1_1polyfill.html#o4">00162</a>         cell**    <a class="code" href="classagg_1_1polyfill.html#o4">m_cells</a>;
<a name="l00163"></a><a class="code" href="classagg_1_1polyfill.html#o5">00163</a>         cell*     <a class="code" href="classagg_1_1polyfill.html#o5">m_cur_cell_ptr</a>;
<a name="l00164"></a><a class="code" href="classagg_1_1polyfill.html#o6">00164</a>         cell**    <a class="code" href="classagg_1_1polyfill.html#o6">m_sorted_cells</a>;
<a name="l00165"></a><a class="code" href="classagg_1_1polyfill.html#o7">00165</a>         <font class="keywordtype">unsigned</font>  <a class="code" href="classagg_1_1polyfill.html#o7">m_sorted_size</a>;
<a name="l00166"></a><a class="code" href="classagg_1_1polyfill.html#o8">00166</a>         <font class="keywordtype">unsigned</font>  <a class="code" href="classagg_1_1polyfill.html#o8">m_flags</a>;
<a name="l00167"></a><a class="code" href="classagg_1_1polyfill.html#o9">00167</a>         <font class="keyword">const</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>* <a class="code" href="classagg_1_1polyfill.html#o9">m_gamma</a>;
00168 
<a name="l00169"></a><a class="code" href="classagg_1_1polyfill.html#o10">00169</a>         cell      <a class="code" href="classagg_1_1polyfill.html#o10">m_cur_cell</a>;
<a name="l00170"></a><a class="code" href="classagg_1_1polyfill.html#o11">00170</a>         <font class="keywordtype">int</font>       <a class="code" href="classagg_1_1polyfill.html#o11">m_cur_x</a>;
<a name="l00171"></a><a class="code" href="classagg_1_1polyfill.html#o12">00171</a>         <font class="keywordtype">int</font>       <a class="code" href="classagg_1_1polyfill.html#o12">m_cur_y</a>;
<a name="l00172"></a><a class="code" href="classagg_1_1polyfill.html#o13">00172</a>         <font class="keywordtype">int</font>       <a class="code" href="classagg_1_1polyfill.html#o13">m_close_x</a>;
<a name="l00173"></a><a class="code" href="classagg_1_1polyfill.html#o14">00173</a>         <font class="keywordtype">int</font>       <a class="code" href="classagg_1_1polyfill.html#o14">m_close_y</a>;
<a name="l00174"></a><a class="code" href="classagg_1_1polyfill.html#o15">00174</a>         <font class="keywordtype">int</font>       <a class="code" href="classagg_1_1polyfill.html#o15">m_min_x</a>;
<a name="l00175"></a><a class="code" href="classagg_1_1polyfill.html#o16">00175</a>         <font class="keywordtype">int</font>       <a class="code" href="classagg_1_1polyfill.html#o16">m_max_x</a>;
<a name="l00176"></a><a class="code" href="classagg_1_1polyfill.html#o17">00176</a>         scanline  <a class="code" href="classagg_1_1polyfill.html#o17">m_scanline</a>;
00177 
00178         <font class="keyword">static</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> <a class="code" href="classagg_1_1polyfill.html#r0">s_default_gamma</a>[];
00179     };
00180 
00181 
00182 
00183     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00184"></a><a class="code" href="classagg_1_1polyfill.html#a9">00184</a>     <font class="keyword">inline</font> <font class="keywordtype">int</font> polyfill::calc_alpha(<font class="keywordtype">int</font> area)
00185     {
00186         <font class="keywordtype">int</font> cover = area &gt;&gt; (<a class="code" href="namespaceagg.html#a59a11">poly_base_shift</a>*2 - <a class="code" href="namespaceagg.html#a62a20">aa_levels_shift</a> + 1);
00187 
00188         <font class="keywordflow">if</font>(cover &lt; 0) cover = -cover;
00189         <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1polyfill.html#o8">m_flags</a> &amp; <a class="code" href="namespaceagg.html#a65a36">even_odd_fill</a>)
00190         {
00191             cover &amp;= <a class="code" href="namespaceagg.html#a62a24">aa_levels_2mask</a>;
00192 
00193             <font class="keywordflow">if</font>(cover &gt; <a class="code" href="namespaceagg.html#a62a21">aa_levels_num</a>)
00194             {
00195                 cover = <a class="code" href="namespaceagg.html#a62a23">aa_levels_2num</a> - cover;
00196             }
00197         }
00198         <font class="keywordflow">if</font>(cover &gt; <a class="code" href="namespaceagg.html#a62a22">aa_levels_mask</a>) cover = <a class="code" href="namespaceagg.html#a62a22">aa_levels_mask</a>;
00199         <font class="keywordflow">return</font> <a class="code" href="classagg_1_1polyfill.html#o9">m_gamma</a>[cover];
00200     }
00201 
00202 
00203 
00204 
00205     <font class="comment">//------------------------------------------------------------------------</font>
00206     <font class="keyword">template</font>&lt;<font class="keyword">class</font> Renderer, <font class="keyword">class</font> Polygon&gt; 
00207     <font class="keywordtype">void</font> <a class="code" href="namespaceagg.html#a54">render_polygon</a>(Renderer* r, Polygon* pf)
00208     {
00209         <font class="keyword">const</font> cell* <font class="keyword">const</font>* cells = pf-&gt;get_cells();
00210 
00211         <font class="keywordflow">if</font>(cells == 0) <font class="keywordflow">return</font>;
00212 
00213         <font class="keywordtype">int</font> x, y;
00214         <font class="keywordtype">int</font> cover;
00215         <font class="keywordtype">int</font> alpha;
00216         <font class="keywordtype">int</font> area;
00217 
00218         scanline* sl = pf-&gt;get_scanline();
00219         sl-&gt;reset_spans();
00220 
00221         cover = 0;
00222 
00223         cell_iterator it(cells);
00224 
00225         <font class="keyword">const</font> cell* cur_cell = it.get_next();
00226         <font class="keywordflow">for</font>(;;)
00227         {
00228             <font class="keyword">const</font> cell* start_cell = cur_cell;
00229 
00230             <font class="keywordtype">int</font> coord  = cur_cell-&gt;packed_coord;
00231             x = cur_cell-&gt;x;
00232             y = cur_cell-&gt;y;
00233 
00234             area   = start_cell-&gt;area;
00235             cover += start_cell-&gt;cover;
00236 
00237             <font class="comment">//accumulate all start cells</font>
00238             <font class="keywordflow">while</font>((cur_cell = it.get_next()) != 0)
00239             {
00240                 <font class="keywordflow">if</font>(cur_cell-&gt;packed_coord != coord) <font class="keywordflow">break</font>;
00241                 area  += cur_cell-&gt;area;
00242                 cover += cur_cell-&gt;cover;
00243             }
00244 
00245             <font class="keywordflow">if</font>(area)
00246             {
00247                 alpha = pf-&gt;calc_alpha((cover &lt;&lt; (<a class="code" href="namespaceagg.html#a59a11">poly_base_shift</a> + 1)) - area);
00248                 <font class="keywordflow">if</font>(alpha)
00249                 {
00250                     <font class="keywordflow">if</font>(sl-&gt;is_ready(y))
00251                     {
00252                         r-&gt;render(sl);
00253                         sl-&gt;reset_spans();
00254                     }
00255                     sl-&gt;add_cell(x, y, alpha);
00256                 }
00257                 x++;
00258             }
00259 
00260             <font class="keywordflow">if</font>(!cur_cell) <font class="keywordflow">break</font>;
00261 
00262             <font class="keywordflow">if</font>(cur_cell-&gt;x &gt; x)
00263             {
00264                 alpha = pf-&gt;calc_alpha(cover &lt;&lt; (<a class="code" href="namespaceagg.html#a59a11">poly_base_shift</a> + 1));
00265                 <font class="keywordflow">if</font>(alpha)
00266                 {
00267                     <font class="keywordflow">if</font>(sl-&gt;is_ready(y))
00268                     {
00269                         r-&gt;render(sl);
00270                         sl-&gt;reset_spans();
00271                     }
00272                     sl-&gt;add_span(x, y, cur_cell-&gt;x - x, alpha);
00273                 }
00274             }
00275         } 
00276 
00277         <font class="keywordflow">if</font>(sl-&gt;get_num_spans())
00278         {
00279             r-&gt;render(sl);
00280         }
00281     }
00282 
00283 
00284 
00285 
00286     <font class="comment">//------------------------------------------------------------------------</font>
00287     <font class="keyword">template</font>&lt;<font class="keyword">class</font> Polygon, <font class="keyword">class</font> VertexSource&gt;
00288     <font class="keywordtype">void</font> <a class="code" href="namespaceagg.html#a55">make_polygon</a>(Polygon* pf, VertexSource* vs, <font class="keywordtype">unsigned</font> start)
00289     {
00290         <font class="keywordtype">double</font> x;
00291         <font class="keywordtype">double</font> y;
00292 
00293         <a class="code" href="namespaceagg.html#a63">pathflag_e</a> flag;
00294         vs-&gt;reset_iterator(start);
00295         <font class="keywordflow">while</font>((flag = vs-&gt;next_vertex(&amp;x, &amp;y)) != <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>)
00296         {
00297             <font class="keywordflow">if</font>(flag == <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>) 
00298             {
00299                 pf-&gt;move_to(<a class="code" href="namespaceagg.html#a47">poly_coord</a>(x), <a class="code" href="namespaceagg.html#a47">poly_coord</a>(y));
00300             }
00301             <font class="keywordflow">else</font> 
00302             {
00303                 pf-&gt;line_to(<a class="code" href="namespaceagg.html#a47">poly_coord</a>(x), <a class="code" href="namespaceagg.html#a47">poly_coord</a>(y));
00304             }
00305         }
00306 
00307     }
00308 
00309 
00310 
00311     <font class="comment">//------------------------------------------------------------------------</font>
00312     <font class="keyword">template</font>&lt;<font class="keyword">class</font> Renderer, <font class="keyword">class</font> Polygon, <font class="keyword">class</font> VertexSource, <font class="keyword">class</font> AttrStorage, <font class="keyword">class</font> PathIdx&gt;
00313     <font class="keywordtype">void</font> <a class="code" href="namespaceagg.html#a56">render_all_paths</a>(Renderer* r, 
00314                           Polygon* pf, 
00315                           VertexSource* vs, 
00316                           <font class="keyword">const</font> AttrStorage&amp; as, 
00317                           <font class="keyword">const</font> PathIdx&amp; idx,
00318                           <font class="keywordtype">unsigned</font> num_paths)
00319     {
00320         <font class="keywordflow">for</font>(<font class="keywordtype">unsigned</font> i = 0; i &lt; num_paths; i++)
00321         {
00322             <a class="code" href="namespaceagg.html#a55">make_polygon</a>(pf, vs, idx[i]);
00323             r-&gt;set_attribute(as[i]);
00324             <a class="code" href="namespaceagg.html#a54">render_polygon</a>(r, pf);
00325         }
00326     }
00327 
00328 
00329 
00330 
00331 }
00332 
00333 
00334 
00335 <font class="preprocessor">#endif</font>
00336 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated on Tue Apr 23 09:06:33 2002 for AGG v2.0 beta by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
