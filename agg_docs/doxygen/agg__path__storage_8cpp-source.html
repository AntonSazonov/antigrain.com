<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>agg_path_storage.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>agg_path_storage.cpp</h1><a href="agg__path__storage_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------------</font>
00002 <font class="comment">// Anti-Grain Geometry - Version 2.0 </font>
00003 <font class="comment">// Copyright (C) 2002 Maxim Shemanarev (McSeem)</font>
00004 <font class="comment">//</font>
00005 <font class="comment">// Permission to copy, use, modify, sell and distribute this software </font>
00006 <font class="comment">// is granted provided this copyright notice appears in all copies. </font>
00007 <font class="comment">// This software is provided "as is" without express or implied</font>
00008 <font class="comment">// warranty, and with no claim as to its suitability for any purpose.</font>
00009 <font class="comment">//</font>
00010 <font class="comment">//----------------------------------------------------------------------------</font>
00011 <font class="comment">// Contact: mcseem@antigrain.com</font>
00012 <font class="comment">//          mcseemagg@yahoo.com</font>
00013 <font class="comment">//          http://www.antigrain.com</font>
00014 <font class="comment">//----------------------------------------------------------------------------</font>
00015 <font class="comment">//</font>
00016 <font class="comment">// Class path_storage</font>
00017 <font class="comment">//</font>
00018 <font class="comment">//----------------------------------------------------------------------------</font>
00019 <font class="preprocessor">#include &lt;string.h&gt;</font>
00020 <font class="preprocessor">#include &lt;math.h&gt;</font>
00021 <font class="preprocessor">#include "<a class="code" href="agg__path__storage_8h.html">agg_path_storage.h</a>"</font>
00022 <font class="preprocessor">#include "<a class="code" href="agg__math_8h.html">agg_math.h</a>"</font>
00023 
00024 
00025 <font class="keyword">namespace </font>agg
00026 {
00027 
00028     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00029"></a><a class="code" href="classagg_1_1path__storage.html#a0">00029</a>     path_storage::~path_storage()
00030     {
00031         <font class="keywordflow">if</font>(m_total_blocks)
00032         {
00033             <font class="keywordtype">double</font>** coord_blk = <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a> + <a class="code" href="classagg_1_1path__storage.html#o1">m_total_blocks</a> - 1;
00034             <font class="keywordflow">while</font>(<a class="code" href="classagg_1_1path__storage.html#o1">m_total_blocks</a>--)
00035             {
00036                 <font class="keyword">delete</font> [] *coord_blk;
00037                 --coord_blk;
00038             }
00039             <font class="keyword">delete</font> [] <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a>;
00040         }
00041     }
00042 
00043 
00044     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00045"></a><a class="code" href="classagg_1_1path__storage.html#a1">00045</a>     path_storage::path_storage() :
00046         m_total_vertices(0),
00047         m_total_blocks(0),
00048         m_max_blocks(0),
00049         m_coord_blocks(0),
00050         m_flag_blocks(0),
00051         m_iterator(0),
00052         m_cur_orient(<a class="code" href="namespaceagg.html#a64a30">orientation_unknown</a>)
00053     {
00054     }
00055 
00056 
00057     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00058"></a><a class="code" href="classagg_1_1path__storage.html#a2">00058</a>     path_storage::path_storage(<font class="keyword">const</font> path_storage&amp; ps) : 
00059         m_total_vertices(0),
00060         m_total_blocks(0),
00061         m_max_blocks(0),
00062         m_coord_blocks(0),
00063         m_flag_blocks(0),
00064         m_iterator(0),
00065         m_cur_orient(<a class="code" href="namespaceagg.html#a64a30">orientation_unknown</a>)
00066     {
00067         <a class="code" href="classagg_1_1path__storage.html#a10">copy_from</a>(ps);
00068     }
00069 
00070 
00071     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00072"></a><a class="code" href="classagg_1_1path__storage.html#a3">00072</a>     <font class="keywordtype">void</font> path_storage::remove_all()
00073     {
00074         <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a> = 0;
00075         <a class="code" href="classagg_1_1path__storage.html#o5">m_iterator</a> = 0;
00076         <a class="code" href="classagg_1_1path__storage.html#o6">m_cur_orient</a> = <a class="code" href="namespaceagg.html#a64a30">orientation_unknown</a>;
00077     }
00078 
00079 
00080     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00081"></a><a class="code" href="classagg_1_1path__storage.html#a10">00081</a>     <font class="keywordtype">void</font> path_storage::copy_from(<font class="keyword">const</font> path_storage&amp; ps)
00082     {
00083         <a class="code" href="classagg_1_1path__storage.html#a3">remove_all</a>();
00084         <font class="keywordtype">unsigned</font> i;
00085         <font class="keywordflow">for</font>(i = 0; i &lt; ps.total_vertices(); i++)
00086         {
00087             <font class="keywordtype">double</font> x, y;
00088             <font class="keywordtype">unsigned</font> flags = ps.get_vertex_with_flags(i, &amp;x, &amp;y);
00089             <a class="code" href="classagg_1_1path__storage.html#a21">add_vertex</a>(x, y, flags);
00090         }
00091     }
00092 
00093 
00094     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00095"></a><a class="code" href="classagg_1_1path__storage.html#c3">00095</a>     <font class="keywordtype">void</font> path_storage::allocate_block(<font class="keywordtype">unsigned</font> nb)
00096     {
00097         <font class="keywordflow">if</font>(nb &gt;= <a class="code" href="classagg_1_1path__storage.html#o2">m_max_blocks</a>) 
00098         {
00099             <font class="keywordtype">double</font>** new_coords = 
00100                 <font class="keyword">new</font> <font class="keywordtype">double</font>* [(<a class="code" href="classagg_1_1path__storage.html#o2">m_max_blocks</a> + <a class="code" href="classagg_1_1path__storage.html#u4u3">block_pool</a>) * 2];
00101 
00102             <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>** new_flags = 
00103                 (<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>**)(new_coords + <a class="code" href="classagg_1_1path__storage.html#o2">m_max_blocks</a> + <a class="code" href="classagg_1_1path__storage.html#u4u3">block_pool</a>);
00104 
00105             <font class="keywordflow">if</font>(m_coord_blocks)
00106             {
00107                 memcpy(new_coords, 
00108                        <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a>, 
00109                        <a class="code" href="classagg_1_1path__storage.html#o2">m_max_blocks</a> * <font class="keyword">sizeof</font>(<font class="keywordtype">double</font>*));
00110 
00111                 memcpy(new_flags, 
00112                        <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>, 
00113                        <a class="code" href="classagg_1_1path__storage.html#o2">m_max_blocks</a> * <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>*));
00114 
00115                 <font class="keyword">delete</font> [] <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a>;
00116             }
00117             <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a> = new_coords;
00118             <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a> = new_flags;
00119             <a class="code" href="classagg_1_1path__storage.html#o2">m_max_blocks</a> += <a class="code" href="classagg_1_1path__storage.html#u4u3">block_pool</a>;
00120         }
00121         <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a>[nb] = 
00122             <font class="keyword">new</font> <font class="keywordtype">double</font> [<a class="code" href="classagg_1_1path__storage.html#u4u1">block_size</a> * 2 + 
00123                         <a class="code" href="classagg_1_1path__storage.html#u4u1">block_size</a> / 
00124                         (<font class="keyword">sizeof</font>(double) / <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>))];
00125 
00126         <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[nb]  = 
00127             (<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>*)(<a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a>[nb] + <a class="code" href="classagg_1_1path__storage.html#u4u1">block_size</a> * 2);
00128 
00129         <a class="code" href="classagg_1_1path__storage.html#o1">m_total_blocks</a>++;
00130     }
00131 
00132 
00133     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00134"></a><a class="code" href="classagg_1_1path__storage.html#a15">00134</a>     <font class="keywordtype">void</font> path_storage::reset_iterator(<font class="keywordtype">unsigned</font> start)
00135     {
00136         <a class="code" href="classagg_1_1path__storage.html#o5">m_iterator</a> = start; 
00137         <a class="code" href="classagg_1_1path__storage.html#o6">m_cur_orient</a> = <a class="code" href="namespaceagg.html#a64a30">orientation_unknown</a>;
00138     }
00139 
00140     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00141"></a><a class="code" href="classagg_1_1path__storage.html#a6">00141</a>     <font class="keywordtype">void</font> path_storage::curve3(<font class="keywordtype">double</font> x_ctrl, <font class="keywordtype">double</font> y_ctrl, 
00142                               <font class="keywordtype">double</font> x_to,   <font class="keywordtype">double</font> y_to)
00143     {
00144         <a class="code" href="classagg_1_1path__storage.html#a21">add_vertex</a>(x_ctrl, y_ctrl, <a class="code" href="namespaceagg.html#a63a28">pathflag_curve3</a>);
00145         <a class="code" href="classagg_1_1path__storage.html#a21">add_vertex</a>(x_to,   y_to,   <a class="code" href="namespaceagg.html#a63a28">pathflag_curve3</a>);
00146     }
00147 
00148 
00149     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00150"></a><a class="code" href="classagg_1_1path__storage.html#a7">00150</a>     <font class="keywordtype">void</font> path_storage::curve4(<font class="keywordtype">double</font> x_ctrl1, <font class="keywordtype">double</font> y_ctrl1, 
00151                                      <font class="keywordtype">double</font> x_ctrl2, <font class="keywordtype">double</font> y_ctrl2, 
00152                                      <font class="keywordtype">double</font> x_to,    <font class="keywordtype">double</font> y_to)
00153     {
00154         <a class="code" href="classagg_1_1path__storage.html#a21">add_vertex</a>(x_ctrl1, y_ctrl1, <a class="code" href="namespaceagg.html#a63a29">pathflag_curve4</a>);
00155         <a class="code" href="classagg_1_1path__storage.html#a21">add_vertex</a>(x_ctrl2, y_ctrl2, <a class="code" href="namespaceagg.html#a63a29">pathflag_curve4</a>);
00156         <a class="code" href="classagg_1_1path__storage.html#a21">add_vertex</a>(x_to,    y_to,    <a class="code" href="namespaceagg.html#a63a29">pathflag_curve4</a>);
00157     }
00158 
00159 
00160 
00161     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00162"></a><a class="code" href="classagg_1_1path__storage.html#a9">00162</a>     <font class="keywordtype">unsigned</font> path_storage::add_new_path()
00163     {
00164         <font class="keywordflow">if</font>(m_total_vertices)
00165         {
00166             <a class="code" href="classagg_1_1path__storage.html#a21">add_vertex</a>(0.0, 0.0, <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>);
00167         }
00168         <font class="keywordflow">return</font> <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a>;
00169     }
00170 
00171 
00172     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00173"></a><a class="code" href="classagg_1_1path__storage.html#c1">00173</a>     <font class="keywordtype">bool</font> path_storage::filtered(<font class="keywordtype">unsigned</font> prev, <font class="keywordtype">unsigned</font> curr, <font class="keywordtype">unsigned</font> next)<font class="keyword"> const</font>
00174 <font class="keyword">    </font>{
00175         <font class="keywordtype">double</font> x, y, x1, y1, x2, y2;
00176         <a class="code" href="classagg_1_1path__storage.html#a13">get_vertex</a>(prev, &amp;x1, &amp;y1);
00177         <a class="code" href="classagg_1_1path__storage.html#a13">get_vertex</a>(curr, &amp;x2, &amp;y2);
00178         <a class="code" href="classagg_1_1path__storage.html#a13">get_vertex</a>(next, &amp;x,  &amp;y);
00179 
00180         <font class="comment">//return fabs(calc_point_line_distance(x1, y1, x2, y2, x, y)) &lt; 1.0;</font>
00181 
00182         <font class="comment">//ATTN! filter_epsilon should be an argument</font>
00183         <font class="keywordflow">return</font> fabs((x - x2) * (y2 - y1) - (y - y2) * (x2 - x1)) &lt; <a class="code" href="namespaceagg.html#a34">filter_epsilon_pos</a>;
00184     }
00185 
00186 
00187     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00188"></a><a class="code" href="classagg_1_1path__storage.html#c2">00188</a>     <font class="keywordtype">void</font> path_storage::copy_vertex(<font class="keywordtype">unsigned</font> to, <font class="keywordtype">unsigned</font> from)
00189     {
00190         <font class="keyword">register</font> <font class="keywordtype">unsigned</font> nb_from = from &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>;
00191         <font class="keyword">register</font> <font class="keywordtype">double</font>*  pv_from = <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a>[nb_from] + ((from &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>) &lt;&lt; 1);
00192         <font class="keyword">register</font> <font class="keywordtype">unsigned</font> nb_to   = to &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>;
00193         <font class="keyword">register</font> <font class="keywordtype">double</font>*  pv_to   = <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a>[nb_to] + ((to &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>) &lt;&lt; 1);
00194         *pv_to++ = *pv_from++;
00195         *pv_to++ = *pv_from++;
00196         <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[nb_to][to &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>] = <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[nb_from][from &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>];
00197     }
00198 
00199 
00200     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00201"></a><a class="code" href="classagg_1_1path__storage.html#a17">00201</a>     <font class="keywordtype">void</font> path_storage::filter_vertices(<font class="keywordtype">bool</font> closed)
00202     {
00203         <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a> &lt; 3) <font class="keywordflow">return</font>;
00204         <font class="keywordtype">unsigned</font> prev = 0;
00205         <font class="keywordtype">unsigned</font> curr = 1;
00206         <font class="keywordtype">unsigned</font> dest = 1;
00207         <font class="keywordtype">unsigned</font> next = 2;
00208         <font class="keywordtype">unsigned</font> i;
00209         <font class="keywordflow">for</font>(i = 2; i &lt; <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a>; i++)
00210         {
00211             <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1path__storage.html#c1">filtered</a>(prev, curr, next))
00212             {
00213                 <a class="code" href="classagg_1_1path__storage.html#c2">copy_vertex</a>(dest, next);
00214             }
00215             <font class="keywordflow">else</font>
00216             {
00217                 ++prev;
00218                 ++curr;
00219                 ++dest;
00220                 <font class="keywordflow">if</font>(dest &lt; next) 
00221                 {
00222                     <a class="code" href="classagg_1_1path__storage.html#c2">copy_vertex</a>(dest, next);
00223                 }
00224             }
00225             ++next;
00226         }
00227         <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a> = dest + 1;
00228 
00229         <font class="keywordflow">if</font>(closed &amp;&amp; <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a> &gt; 2)
00230         {
00231             <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1path__storage.html#c1">filtered</a>(<a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a> - 1, 0, 1))
00232             {
00233                 <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a>--;
00234             }
00235         }
00236     }
00237 
00238 
00239 
00240 
00241 
00242     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00243"></a><a class="code" href="classagg_1_1path__storage.html#a18">00243</a>     <font class="keywordtype">void</font> path_storage::get_bound_rect(<font class="keywordtype">double</font>* x1, <font class="keywordtype">double</font>* y1, <font class="keywordtype">double</font>* x2, <font class="keywordtype">double</font>* y2)
00244     {
00245         *x1 = *y1 = *x2 = *y2 = 0;
00246         <font class="keywordflow">if</font>(m_total_vertices)
00247         {
00248             <font class="keywordtype">double</font> x, y;
00249             <a class="code" href="classagg_1_1path__storage.html#a13">get_vertex</a>(0, &amp;x, &amp;y);
00250             *x1 = *x2 = x;
00251             *y1 = *y2 = y;
00252             <font class="keywordflow">for</font>(<font class="keywordtype">unsigned</font> i = 1; i &lt; <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a>; i++)
00253             {
00254                 <font class="keywordflow">if</font>(<a class="code" href="classagg_1_1path__storage.html#a13">get_vertex</a>(i, &amp;x, &amp;y) != <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>)
00255                 {
00256                     <font class="keywordflow">if</font>(x &lt; *x1) *x1 = x;
00257                     <font class="keywordflow">if</font>(y &lt; *y1) *y1 = y;
00258                     <font class="keywordflow">if</font>(x &gt; *x2) *x2 = x;
00259                     <font class="keywordflow">if</font>(y &gt; *y2) *y2 = y;
00260                 }
00261             }
00262         }
00263     }
00264 
00265 
00266 
00267     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00268"></a><a class="code" href="classagg_1_1path__storage.html#c5">00268</a>     <font class="keywordtype">unsigned</font> path_storage::perceive_polygon_orientation(<font class="keywordtype">unsigned</font> idx, 
00269                                                         <font class="keywordtype">double</font> xs, 
00270                                                         <font class="keywordtype">double</font> ys)
00271     {
00272         <font class="keywordtype">unsigned</font> i, flags;
00273         <font class="keywordtype">double</font> sum = 0.0;
00274         <font class="keywordtype">double</font> x = xs;
00275         <font class="keywordtype">double</font> y = ys;
00276         <font class="keywordtype">double</font> x1, y1;
00277 
00278         <font class="keywordflow">for</font>(i = idx + 1; i &lt; <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a>; i++)
00279         {
00280             flags = <a class="code" href="classagg_1_1path__storage.html#c0">get_vertex_with_flags</a>(i, &amp;x1, &amp;y1) &amp; 0xF;
00281             <font class="keywordflow">if</font>(flags == <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a> || flags == <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>) <font class="keywordflow">break</font>;
00282             sum += x * y1 - y * x1;
00283             x = x1;
00284             y = y1;
00285         }
00286         sum += x * ys - y * xs;
00287 
00288         <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>* flags_ptr = <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[idx &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>] + (idx &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>);
00289         *flags_ptr = (<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>)(*flags_ptr &amp; ~(<a class="code" href="namespaceagg.html#a64a32">orientation_cw</a> | <a class="code" href="namespaceagg.html#a64a31">orientation_ccw</a>)) | 
00290                                     ((sum &lt; 0.0) ? <a class="code" href="namespaceagg.html#a64a32">orientation_cw</a> : <a class="code" href="namespaceagg.html#a64a31">orientation_ccw</a>);
00291 
00292         <font class="keywordflow">return</font> i - idx - 1;
00293     }
00294 
00295 
00296 
00297     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00298"></a><a class="code" href="classagg_1_1path__storage.html#a19">00298</a>     <font class="keywordtype">int</font> path_storage::perceive_orientation(<font class="keywordtype">unsigned</font> start)
00299     {
00300         <font class="keywordtype">unsigned</font> i, flags;
00301         <font class="keywordtype">double</font> x, y;
00302         <font class="keywordtype">int</font> balance = 0;
00303 
00304         <font class="keywordflow">for</font>(i = start; i &lt; <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a>; i++)
00305         {
00306             flags = <a class="code" href="classagg_1_1path__storage.html#c0">get_vertex_with_flags</a>(i, &amp;x, &amp;y);
00307             <font class="keywordflow">if</font>((flags &amp; 0xF) == <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>)
00308             {
00309                 <font class="keywordtype">int</font> n = <a class="code" href="classagg_1_1path__storage.html#c5">perceive_polygon_orientation</a>(i, x, y);
00310                 flags = <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[i &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>][i &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>];
00311                 <font class="keywordflow">if</font>(flags &amp; <a class="code" href="namespaceagg.html#a64a31">orientation_ccw</a>) balance++;
00312                 <font class="keywordflow">if</font>(flags &amp; <a class="code" href="namespaceagg.html#a64a32">orientation_cw</a>)  balance--;
00313                 i += n;
00314             }
00315             <font class="keywordflow">if</font>((flags &amp; 0xF) == <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>) <font class="keywordflow">break</font>;
00316         }
00317         <font class="keywordflow">return</font> balance;
00318     }
00319 
00320 
00321 
00322     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00323"></a><a class="code" href="classagg_1_1path__storage.html#c6">00323</a>     <font class="keywordtype">void</font> path_storage::reverse_orientation(<font class="keywordtype">unsigned</font> start, <font class="keywordtype">unsigned</font> end)
00324     {
00325         <font class="keywordtype">unsigned</font> i;
00326         <font class="keywordtype">unsigned</font> tmp_flag = <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[start &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>][start &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>];
00327         
00328         <font class="comment">// Shift all attributes to one position</font>
00329         <font class="keywordflow">for</font>(i = start; i &lt; end; i++)
00330         {
00331             <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[i &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>][i &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>] = 
00332                 <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[(i + 1) &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>][(i + 1) &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>];
00333         }
00334 
00335         <font class="comment">// Assign move_to to the ending flag</font>
00336         <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[end &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>][end &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>] = (<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>)tmp_flag;
00337 
00338         <font class="comment">// Reverse the polygon</font>
00339         <font class="keywordflow">while</font>(end &gt; start)
00340         {
00341             <font class="keywordtype">unsigned</font> start_nb = start &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>;
00342             <font class="keywordtype">unsigned</font> end_nb   = end   &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>;
00343             <font class="keywordtype">double</font>* start_ptr = <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a>[start_nb] + ((start &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>) &lt;&lt; 1);
00344             <font class="keywordtype">double</font>* end_ptr   = <a class="code" href="classagg_1_1path__storage.html#o3">m_coord_blocks</a>[end_nb]   + ((end   &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>) &lt;&lt; 1);
00345             <font class="keywordtype">double</font> tmp_xy;
00346 
00347             tmp_xy       = *start_ptr;
00348             *start_ptr++ = *end_ptr;
00349             *end_ptr++   = tmp_xy;
00350 
00351             tmp_xy       = *start_ptr;
00352             *start_ptr   = *end_ptr;
00353             *end_ptr     = tmp_xy;
00354 
00355             tmp_flag = <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[start_nb][start &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>];
00356             <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[start_nb][start &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>] = <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[end_nb][end &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>];
00357             <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[end_nb][end &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>] = (<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>)tmp_flag;
00358 
00359             ++start;
00360             --end;
00361         }
00362 
00363 
00364     }
00365 
00366 
00367 
00368 
00369 
00370     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00371"></a><a class="code" href="classagg_1_1path__storage.html#a20">00371</a>     <font class="keywordtype">void</font> path_storage::arrange_orientation(<font class="keywordtype">unsigned</font> start,
00372                                            <font class="keywordtype">bool</font> perception_flag, 
00373                                            <a class="code" href="namespaceagg.html#a64">orientation_e</a> new_orient)
00374     {
00375         <font class="keywordtype">int</font> balance = 0;
00376         <font class="keywordflow">if</font>(perception_flag)
00377         {
00378             balance = <a class="code" href="classagg_1_1path__storage.html#a19">perceive_orientation</a>(start);
00379             <font class="keywordflow">if</font>(new_orient == <a class="code" href="namespaceagg.html#a64a30">orientation_unknown</a>)
00380             {
00381                 new_orient = (balance &gt;= 0) ? <a class="code" href="namespaceagg.html#a64a31">orientation_ccw</a> : <a class="code" href="namespaceagg.html#a64a32">orientation_cw</a>;
00382             }
00383         }
00384 
00385         <font class="keywordflow">if</font>(new_orient != <a class="code" href="namespaceagg.html#a64a30">orientation_unknown</a>)
00386         {
00387             <font class="keywordtype">unsigned</font> i;
00388             <a class="code" href="namespaceagg.html#a64">orientation_e</a> of = <a class="code" href="namespaceagg.html#a64a30">orientation_unknown</a>;
00389             <font class="keywordtype">unsigned</font> start_i = 0;
00390 
00391             <font class="keywordflow">for</font>(i = start; i &lt; <a class="code" href="classagg_1_1path__storage.html#o0">m_total_vertices</a>; i++)
00392             {
00393                 <font class="keywordtype">unsigned</font> <font class="keywordtype">char</font> flags = <a class="code" href="classagg_1_1path__storage.html#o4">m_flag_blocks</a>[i &gt;&gt; <a class="code" href="classagg_1_1path__storage.html#u4u0">block_shift</a>][i &amp; <a class="code" href="classagg_1_1path__storage.html#u4u2">block_mask</a>];
00394                 <a class="code" href="namespaceagg.html#a63">pathflag_e</a> pf = <a class="code" href="namespaceagg.html#a63">pathflag_e</a>(flags &amp; 0xF);
00395 
00396                 <font class="keywordflow">if</font>(pf == <a class="code" href="namespaceagg.html#a63a25">pathflag_stop</a>) <font class="keywordflow">break</font>;
00397 
00398                 <font class="keywordflow">if</font>(pf == <a class="code" href="namespaceagg.html#a63a26">pathflag_move_to</a>)
00399                 {
00400                     <font class="keywordflow">if</font>(i &gt; start_i &amp;&amp; of != <a class="code" href="namespaceagg.html#a64a30">orientation_unknown</a> &amp;&amp; of != new_orient)
00401                     {
00402                         <a class="code" href="classagg_1_1path__storage.html#c6">reverse_orientation</a>(start_i, i - 1);
00403                     }
00404                     start_i = i;
00405                     of = <a class="code" href="namespaceagg.html#a64">orientation_e</a>(flags &amp; (<a class="code" href="namespaceagg.html#a64a31">orientation_ccw</a> | <a class="code" href="namespaceagg.html#a64a32">orientation_cw</a>));
00406                 }
00407             }
00408             <font class="keywordflow">if</font>(i &gt; start_i &amp;&amp; of != <a class="code" href="namespaceagg.html#a64a30">orientation_unknown</a> &amp;&amp; of != new_orient)
00409             {
00410                 <a class="code" href="classagg_1_1path__storage.html#c6">reverse_orientation</a>(start_i, i - 1);
00411             }
00412         }
00413     }
00414 
00415 
00416     <font class="comment">//------------------------------------------------------------------------</font>
<a name="l00417"></a><a class="code" href="classagg_1_1path__storage.html#a8">00417</a>     <font class="keywordtype">void</font> path_storage::add_poly(<font class="keyword">const</font> <font class="keywordtype">double</font>* vertices, <font class="keywordtype">unsigned</font> num,
00418                                 <a class="code" href="namespaceagg.html#a64">orientation_e</a> orient)
00419     {
00420         <font class="keywordflow">if</font>(num &gt; 1)
00421         {
00422             <a class="code" href="classagg_1_1path__storage.html#a4">move_to</a>(*vertices, *(vertices + 1), orient);
00423             vertices += 2;
00424             <font class="keywordflow">while</font>(--num)
00425             {
00426                 <a class="code" href="classagg_1_1path__storage.html#a5">line_to</a>(*vertices, *(vertices + 1));
00427                 vertices += 2;
00428             }
00429         }
00430     }
00431 
00432 
00433 
00434 
00435 }
00436 
</pre></div><hr><address><small>Generated on Tue Apr 23 09:06:33 2002 for AGG v2.0 beta by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
